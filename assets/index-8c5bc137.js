import{r as p,a as ce}from"./vendor-30840fde.js";import{L as _,U as de,T as D,E as he,F as me,D as X,S as ue,M as pe,C as ee,a as ge,I as V,H as xe,b as R,c as fe,P as ye,d as be,e as we,f as ve,g as te,h as je,i as Ne,j as ke}from"./icons-0c6d1b93.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const m of l)if(m.type==="childList")for(const d of m.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function i(l){const m={};return l.integrity&&(m.integrity=l.integrity),l.referrerPolicy&&(m.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?m.credentials="include":l.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function o(l){if(l.ep)return;l.ep=!0;const m=i(l);fetch(l.href,m)}})();var re={exports:{}},J={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ce=p,$e=Symbol.for("react.element"),Ie=Symbol.for("react.fragment"),Ae=Object.prototype.hasOwnProperty,Se=Ce.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Te={key:!0,ref:!0,__self:!0,__source:!0};function se(r,s,i){var o,l={},m=null,d=null;i!==void 0&&(m=""+i),s.key!==void 0&&(m=""+s.key),s.ref!==void 0&&(d=s.ref);for(o in s)Ae.call(s,o)&&!Te.hasOwnProperty(o)&&(l[o]=s[o]);if(r&&r.defaultProps)for(o in s=r.defaultProps,s)l[o]===void 0&&(l[o]=s[o]);return{$$typeof:$e,type:r,key:m,ref:d,props:l,_owner:Se.current}}J.Fragment=Ie;J.jsx=se;J.jsxs=se;re.exports=J;var e=re.exports,ne,Q=ce;ne=Q.createRoot,Q.hydrateRoot;const Le=({selectedModel:r,onSendMessage:s})=>{const[i,o]=p.useState([]),[l,m]=p.useState(!1),[d,f]=p.useState(!1),[b,C]=p.useState(!1),$=p.useRef(null),M=a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?C(!0):a.type==="dragleave"&&C(!1)},I=a=>{a.preventDefault(),a.stopPropagation(),C(!1);const y=[...a.dataTransfer.files];h(y)},S=a=>{const y=[...a.target.files];h(y)},h=async a=>{const y=a.filter(w=>w.type.startsWith("image/"));if(y.length===0){alert("Vui lòng chọn file ảnh (JPG, PNG, GIF, WebP)");return}m(!0);for(const w of y)try{const g=URL.createObjectURL(w),j=await c(w),L=await window.puter.fs.upload([w]);console.log("Upload response:",L);let U="";Array.isArray(L)&&L.length>0?U=L[0].path||L[0].name:L.path?U=L.path:U=L.name||w.name;const q={id:Date.now()+Math.random(),name:w.name,size:w.size,type:w.type,previewUrl:g,filePath:U,base64:j,uploadedFile:L,uploadedAt:new Date};o(H=>[...H,q])}catch(g){console.error("Lỗi upload ảnh:",g),alert(`Lỗi upload ${w.name}: ${g.message}`)}m(!1)},c=a=>new Promise((y,w)=>{const g=new FileReader;g.readAsDataURL(a),g.onload=()=>y(g.result),g.onerror=j=>w(j)}),N=async(a,y="Hãy mô tả chi tiết những gì bạn thấy trong ảnh này")=>{var w;f(!0);try{const g=`${y}

[Phân tích ảnh: ${a.name}]`;console.log("Analyzing image with base64...");const j=await window.puter.ai.chat(g,a.base64,{model:r});let L="";typeof j=="string"?L=j:j&&j.message&&j.message.content?Array.isArray(j.message.content)?L=((w=j.message.content[0])==null?void 0:w.text)||j.message.content[0]:L=j.message.content:j&&j.content?L=j.content:L="AI đã phản hồi nhưng không thể hiển thị nội dung.",s&&s(g,L,a)}catch(g){console.error("Lỗi phân tích ảnh:",g);try{console.log("Trying fallback analysis...");const j=await window.puter.ai.chat(`Phân tích ảnh: ${a.name}. ${y}. 
          
          Lưu ý: Không thể tải ảnh trực tiếp, vui lòng mô tả nội dung ảnh này dựa trên tên file hoặc thử upload ảnh khác với định dạng JPG/PNG.`,{model:r});s&&s(`Phân tích ảnh: ${a.name}`,`⚠️ Không thể phân tích ảnh trực tiếp.

${j}`,a)}catch{s&&s(`Phân tích ảnh: ${a.name}`,`❌ Lỗi phân tích ảnh: ${g.message}

💡 Thử:
- Sử dụng ảnh định dạng JPG/PNG
- Chọn model khác (GPT-4o, Claude Vision)
- Upload ảnh kích thước nhỏ hơn`,a)}}finally{f(!1)}},P=async a=>{var y;f(!0);try{console.log("Extracting text using img2txt...");const g=await window.puter.ai.img2txt(a.base64)||"Không tìm thấy text trong ảnh",j=`Trích xuất text từ ảnh: ${a.name}`;s&&s(j,`**Text được trích xuất:**

${g}`,a)}catch(w){console.error("Lỗi OCR:",w);try{console.log("OCR failed, using vision model...");const g=await window.puter.ai.chat("Trích xuất tất cả text có trong ảnh này. Chỉ trả về text được tìm thấy, không thêm giải thích gì khác.",a.base64,{model:r});let j="";typeof g=="string"?j=g:g&&g.message&&g.message.content?j=Array.isArray(g.message.content)?((y=g.message.content[0])==null?void 0:y.text)||g.message.content[0]:g.message.content:j="Không thể trích xuất text bằng vision model",s&&s(`OCR ảnh: ${a.name}`,`**Text được trích xuất (via Vision):**

${j}`,a)}catch{s&&s(`OCR ảnh: ${a.name}`,`❌ Lỗi trích xuất text: ${w.message}

💡 Thử:
- Ảnh có text rõ ràng hơn
- Định dạng JPG/PNG
- Model khác có vision capability`,a)}}finally{f(!1)}},k=a=>{o(y=>{const w=y.filter(j=>j.id!==a),g=y.find(j=>j.id===a);return g!=null&&g.previewUrl&&URL.revokeObjectURL(g.previewUrl),w})},A=async a=>{try{const y=document.createElement("a");y.href=a.previewUrl,y.download=a.name,y.click()}catch(y){console.error("Lỗi download:",y)}},T=a=>{if(a===0)return"0 Bytes";const y=1024,w=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(a)/Math.log(y));return parseFloat((a/Math.pow(y,g)).toFixed(2))+" "+w[g]};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition duration-200 ${b?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:M,onDragLeave:M,onDragOver:M,onDrop:I,children:[e.jsx("input",{ref:$,type:"file",multiple:!0,accept:"image/*",onChange:S,className:"hidden"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-center",children:l?e.jsx(_,{className:"h-10 w-10 text-blue-500 animate-spin"}):e.jsx(de,{className:"h-10 w-10 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:l?"Đang upload...":"Upload ảnh để phân tích"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Kéo thả ảnh vào đây hoặc click để chọn file"}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Hỗ trợ: JPG, PNG, GIF, WebP • Tối đa 30MB"})]}),e.jsx("button",{onClick:()=>{var a;return(a=$.current)==null?void 0:a.click()},disabled:l,className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 disabled:opacity-50 transition duration-200",children:"Chọn ảnh"})]})]}),i.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-800",children:["Ảnh đã upload (",i.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.map(a=>e.jsxs("div",{className:"border rounded-lg overflow-hidden bg-white shadow-sm",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a.previewUrl,alt:a.name,className:"w-full h-48 object-cover"}),e.jsx("button",{onClick:()=>k(a.id),className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full hover:bg-red-600 transition duration-200",children:e.jsx(D,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"font-medium text-gray-800 truncate",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[T(a.size)," • ",new Date(a.uploadedAt).toLocaleString("vi-VN")]}),e.jsxs("div",{className:"flex space-x-2 mt-3",children:[e.jsxs("button",{onClick:()=>N(a),disabled:d,className:"flex items-center space-x-1 bg-purple-500 text-white px-3 py-1.5 rounded text-sm hover:bg-purple-600 disabled:opacity-50 transition duration-200",children:[d?e.jsx(_,{className:"h-4 w-4 animate-spin"}):e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{children:"Phân tích"})]}),e.jsxs("button",{onClick:()=>P(a),disabled:d,className:"flex items-center space-x-1 bg-green-500 text-white px-3 py-1.5 rounded text-sm hover:bg-green-600 disabled:opacity-50 transition duration-200",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:"OCR"})]}),e.jsx("button",{onClick:()=>A(a),className:"flex items-center space-x-1 bg-gray-500 text-white px-3 py-1.5 rounded text-sm hover:bg-gray-600 transition duration-200",children:e.jsx(X,{className:"h-4 w-4"})})]})]})]},a.id))})]}),i.length>0&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Phân tích nhanh"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[{label:"Mô tả chi tiết",prompt:"Hãy mô tả rất chi tiết những gì bạn thấy trong ảnh này, bao gồm màu sắc, đối tượng, bối cảnh và cảm xúc"},{label:"Trích xuất text",action:"ocr"},{label:"Phân tích biểu đồ",prompt:"Phân tích biểu đồ/chart trong ảnh này và giải thích ý nghĩa của dữ liệu"},{label:"Tìm lỗi code",prompt:"Kiểm tra code trong ảnh này và tìm ra các lỗi hoặc cải tiến có thể"}].map((a,y)=>e.jsx("button",{onClick:()=>{const w=i[i.length-1];a.action==="ocr"?P(w):N(w,a.prompt)},disabled:d||i.length===0,className:"bg-white border border-gray-200 text-gray-700 px-3 py-2 rounded text-sm hover:bg-gray-50 disabled:opacity-50 transition duration-200",children:a.label},y))})]})]})},ae=p.createContext(),B=()=>{const r=p.useContext(ae);if(!r)throw new Error("useTheme must be used within ThemeProvider");return r},Pe=({children:r})=>{const[s,i]=p.useState("light"),[o,l]=p.useState(!0);p.useEffect(()=>{m()},[]),p.useEffect(()=>{s==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[s]);const m=async()=>{try{if(window.puter){const $=await window.puter.kv.get("userTheme");if($){i($),l(!1);return}}const C=localStorage.getItem("theme");if(C)i(C);else{const $=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";i($)}}catch(C){console.error("Error loading theme:",C);const $=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";i($)}finally{l(!1)}},b={theme:s,toggleTheme:async()=>{const C=s==="light"?"dark":"light";i(C);try{window.puter&&await window.puter.kv.set("userTheme",C),localStorage.setItem("theme",C)}catch($){console.error("Error saving theme:",$),localStorage.setItem("theme",C)}},setTheme:async C=>{i(C);try{window.puter&&await window.puter.kv.set("userTheme",C),localStorage.setItem("theme",C)}catch($){console.error("Error saving theme:",$),localStorage.setItem("theme",C)}},isLoading:o,isDark:s==="dark"};return e.jsx(ae.Provider,{value:b,children:r})},Y=({className:r=""})=>{const{theme:s,toggleTheme:i,isLoading:o}=B();return o?e.jsx("div",{className:`w-10 h-10 rounded-lg bg-gray-200 dark:bg-gray-700 animate-pulse ${r}`}):e.jsx("button",{onClick:i,className:`flex items-center justify-center w-10 h-10 rounded-lg transition-all duration-200 hover:scale-105 ${s==="dark"?"bg-yellow-500 text-yellow-900 hover:bg-yellow-400":"bg-slate-700 text-slate-100 hover:bg-slate-600"} ${r}`,title:s==="dark"?"Chuyển sang Light Mode":"Chuyển sang Dark Mode",children:s==="dark"?e.jsx(ue,{className:"h-5 w-5"}):e.jsx(pe,{className:"h-5 w-5"})})},t={bg:{primary:"bg-white dark:bg-gray-900",secondary:"bg-gray-50 dark:bg-gray-800",tertiary:"bg-gray-100 dark:bg-gray-700",accent:"bg-blue-50 dark:bg-blue-900/20",surface:"bg-white dark:bg-gray-800",overlay:"bg-black/50 dark:bg-black/70"},text:{primary:"text-gray-900 dark:text-gray-100",secondary:"text-gray-600 dark:text-gray-300",tertiary:"text-gray-500 dark:text-gray-400",muted:"text-gray-400 dark:text-gray-500",accent:"text-blue-600 dark:text-blue-400",success:"text-green-600 dark:text-green-400",warning:"text-yellow-600 dark:text-yellow-400",danger:"text-red-600 dark:text-red-400"},border:{primary:"border-gray-200 dark:border-gray-700",secondary:"border-gray-300 dark:border-gray-600",accent:"border-blue-200 dark:border-blue-700",focus:"border-blue-500 dark:border-blue-400"},interactive:{hover:"hover:bg-gray-50 dark:hover:bg-gray-700",active:"active:bg-gray-100 dark:active:bg-gray-600",focus:"focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400",disabled:"disabled:opacity-50 disabled:cursor-not-allowed"},button:{primary:"bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 text-white",secondary:"bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200",success:"bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 text-white",warning:"bg-yellow-500 hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-700 text-white",danger:"bg-red-500 hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700 text-white"},card:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-sm dark:shadow-gray-900/10",input:"bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400",gradient:{primary:"bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900/20 dark:to-purple-900/20",header:"bg-gradient-to-r from-blue-500 to-purple-600 dark:from-blue-600 dark:to-purple-700"}},Oe=()=>{B();const[r,s]=p.useState([]),[i,o]=p.useState(""),[l,m]=p.useState(!1),[d,f]=p.useState(null),[b,C]=p.useState("gpt-4o-mini"),[$,M]=p.useState(!1),[I,S]=p.useState(!1),[h,c]=p.useState(!1),[N,P]=p.useState([]),k=p.useRef(null),A=[{id:"gpt-4o",name:"GPT-4o",provider:"OpenAI",description:"Most capable GPT-4 model"},{id:"gpt-4o-mini",name:"GPT-4o Mini",provider:"OpenAI",description:"Faster, cheaper GPT-4o"},{id:"gpt-4.1",name:"GPT-4.1",provider:"OpenAI",description:"Latest GPT-4 iteration"},{id:"gpt-4.1-mini",name:"GPT-4.1 Mini",provider:"OpenAI",description:"Efficient GPT-4.1"},{id:"gpt-4.1-nano",name:"GPT-4.1 Nano",provider:"OpenAI",description:"Ultra-fast GPT-4.1"},{id:"gpt-4.5-preview",name:"GPT-4.5 Preview",provider:"OpenAI",description:"Next-gen preview"},{id:"o1",name:"o1",provider:"OpenAI",description:"Reasoning model"},{id:"o1-mini",name:"o1 Mini",provider:"OpenAI",description:"Efficient reasoning"},{id:"o1-pro",name:"o1 Pro",provider:"OpenAI",description:"Advanced reasoning"},{id:"o3",name:"o3",provider:"OpenAI",description:"Latest reasoning model"},{id:"o3-mini",name:"o3 Mini",provider:"OpenAI",description:"Fast reasoning"},{id:"o4-mini",name:"o4 Mini",provider:"OpenAI",description:"Next-gen reasoning"},{id:"claude-sonnet-4",name:"Claude Sonnet 4",provider:"Anthropic",description:"Latest Claude model"},{id:"claude-opus-4",name:"Claude Opus 4",provider:"Anthropic",description:"Most capable Claude"},{id:"claude-3-5-sonnet",name:"Claude 3.5 Sonnet",provider:"Anthropic",description:"Balanced Claude model"},{id:"claude",name:"Claude 3.7 Sonnet",provider:"Anthropic",description:"Enhanced Claude"},{id:"google/gemini-2.5-flash",name:"Gemini 2.5 Flash",provider:"Google",description:"Fast Google model"},{id:"google/gemini-pro",name:"Gemini Pro",provider:"Google",description:"Google's flagship model"},{id:"meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo",name:"Llama 3.1 70B Turbo",provider:"Meta",description:"Large open-source model"},{id:"meta-llama/llama-3.2-11b-vision-instruct",name:"Llama 3.2 11B Vision",provider:"Meta",description:"Vision-capable Llama"},{id:"openrouter:anthropic/claude-sonnet-4",name:"Claude Sonnet 4 (OpenRouter)",provider:"OpenRouter",description:"Claude via OpenRouter"},{id:"openrouter:google/gemini-pro-vision",name:"Gemini Pro Vision (OpenRouter)",provider:"OpenRouter",description:"Vision Gemini via OpenRouter"}];p.useEffect(()=>{T()},[r]),p.useEffect(()=>{a(),y()},[]),p.useEffect(()=>{r.length>0&&w()},[r]);const T=()=>{var n;(n=k.current)==null||n.scrollIntoView({behavior:"smooth"})},a=async()=>{try{const n=await window.puter.kv.get("savedChats");n&&P(JSON.parse(n))}catch(n){console.error("Lỗi tải lịch sử chat:",n)}},y=async()=>{try{const n=await window.puter.kv.get("currentChatSession");if(n){const x=JSON.parse(n);s(x.messages||[]),f(x.id),x.model&&C(x.model)}}catch(n){console.error("Lỗi tải session hiện tại:",n)}},w=async()=>{var n,x;try{if(!d){const E=Date.now();f(E)}const u={id:d||Date.now(),messages:r,model:b,lastUpdated:new Date,title:((x=(n=r[0])==null?void 0:n.content)==null?void 0:x.substring(0,50))+"..."||"Cuộc trò chuyện"};await window.puter.kv.set("currentChatSession",JSON.stringify(u)),r.length%5===0&&r.length>0&&await g(u)}catch(u){console.error("Lỗi auto-save:",u)}},g=async n=>{try{const x=await window.puter.kv.get("savedChats"),u=x?JSON.parse(x):[],E=u.findIndex(K=>K.id===n.id);E>=0?u[E]={...n,timestamp:new Date}:u.push({...n,timestamp:new Date}),u.length>50&&u.splice(0,u.length-50),await window.puter.kv.set("savedChats",JSON.stringify(u)),P(u)}catch(x){console.error("Lỗi lưu vào lịch sử:",x)}},j=async n=>{var x,u;try{if(r.length>0&&d){const E={id:d,messages:r,model:b,timestamp:new Date,title:((u=(x=r[0])==null?void 0:x.content)==null?void 0:u.substring(0,50))+"..."||"Cuộc trò chuyện"};await g(E)}s(n.messages||[]),f(n.id),C(n.model||"gpt-4o-mini"),S(!1),await window.puter.kv.set("currentChatSession",JSON.stringify(n))}catch(E){console.error("Lỗi tải chat:",E)}},L=async()=>{var n,x;try{if(r.length>0&&d){const u={id:d,messages:r,model:b,timestamp:new Date,title:((x=(n=r[0])==null?void 0:n.content)==null?void 0:x.substring(0,50))+"..."||"Cuộc trò chuyện"};await g(u)}await window.puter.kv.del("currentChatSession"),s([]),f(null)}catch(u){console.error("Lỗi tạo chat mới:",u)}},U=async(n=null,x=null,u=null)=>{var W;const E=n||i;if(!E.trim()||l)return;const K={role:"user",content:E,timestamp:new Date,image:u?{name:u.name,url:u.previewUrl}:null};if(s(v=>[...v,K]),n||o(""),x){const v={role:"assistant",content:x,timestamp:new Date,model:b};s(O=>[...O,v]);return}m(!0);try{console.log("Sending to model:",b);const v=await window.puter.ai.chat(E,{model:b,stream:!1});console.log("AI Response:",v),console.log("AI Response type:",typeof v);let O="";if(typeof v=="string")O=v;else if(v&&v.message&&v.message.content)Array.isArray(v.message.content)?O=((W=v.message.content[0])==null?void 0:W.text)||v.message.content[0]:O=v.message.content;else if(v&&v.content)O=v.content;else if(v&&v.message&&typeof v.message=="string")O=v.message;else if(v&&v.text)O=v.text;else if(Array.isArray(v)&&v.length>0){const G=v[0];G&&G.message&&G.message.content?O=G.message.content:G&&G.content?O=G.content:G&&typeof G=="string"&&(O=G)}else v&&typeof v=="object"?(console.error("Unhandled response format:",v),O=`Response from ${b}: ${JSON.stringify(v,null,2)}`):O="AI đã phản hồi nhưng không thể hiển thị nội dung.";const z={role:"assistant",content:O,timestamp:new Date,model:b};s(G=>[...G,z])}catch(v){console.error("Lỗi chat AI:",v);const O={role:"assistant",content:`Xin lỗi, đã có lỗi khi sử dụng model ${b}. Vui lòng thử model khác hoặc thử lại!`,timestamp:new Date,isError:!0};s(z=>[...z,O])}finally{m(!1)}},q=async()=>{var n,x;if(r.length!==0)try{const u={id:d||Date.now(),title:((x=(n=r[0])==null?void 0:n.content)==null?void 0:x.substring(0,50))+"..."||"Cuộc trò chuyện",messages:r,model:b,timestamp:new Date};await g(u),alert("Chat đã được lưu vào lịch sử!")}catch(u){console.error("Lỗi lưu chat:",u),alert("Có lỗi khi lưu chat. Vui lòng thử lại!")}},H=async()=>{if(r.length===0)return;const n=r.map(u=>`[${u.role.toUpperCase()}${u.model?` - ${u.model}`:""}]: ${u.content}`).join(`

`),x=`chat_${b}_${new Date().getTime()}.txt`;try{await window.puter.fs.write(x,n),alert(`Chat đã được lưu thành file: ${x}`)}catch(u){console.error("Lỗi xuất chat:",u),alert("Có lỗi khi xuất file. Vui lòng thử lại!")}},oe=()=>{L()},le=async n=>{try{const x=N.filter(u=>u.id!==n);P(x),await window.puter.kv.set("savedChats",JSON.stringify(x))}catch(x){console.error("Lỗi xóa chat:",x)}},F=n=>{const x=A.find(u=>u.id===n);return x?`${x.name} (${x.provider})`:n};return e.jsxs("div",{className:`${t.card} rounded-2xl shadow-lg overflow-hidden`,children:[e.jsxs("div",{className:`border-b ${t.border.primary} ${t.bg.secondary} px-6 py-4`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:`text-lg font-semibold ${t.text.primary}`,children:"Trò chuyện với AI"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>M(!$),className:`flex items-center space-x-2 ${t.bg.accent} ${t.text.accent} px-3 py-1.5 rounded-lg ${t.interactive.hover} transition duration-200`,children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:F(b).split(" (")[0]}),e.jsx(ge,{className:"h-4 w-4"})]}),$&&e.jsxs("div",{className:`absolute right-0 top-full mt-2 w-80 ${t.bg.primary} ${t.border.primary} border rounded-lg shadow-lg z-50 max-h-96 overflow-y-auto`,children:[e.jsx("div",{className:`p-3 border-b ${t.border.primary} ${t.bg.secondary}`,children:e.jsx("h3",{className:`font-semibold ${t.text.primary}`,children:"Chọn AI Model"})}),A.map(n=>e.jsx("button",{onClick:()=>{C(n.id),M(!1)},className:`w-full text-left px-4 py-3 ${t.interactive.hover} border-b ${t.border.primary} ${b===n.id?`${t.bg.tertiary} border-l-4 border-l-blue-500`:""}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:`font-medium ${t.text.primary}`,children:n.name}),e.jsx("div",{className:`text-sm ${t.text.secondary}`,children:n.description})]}),e.jsx("span",{className:`text-xs ${t.bg.tertiary} ${t.text.secondary} px-2 py-1 rounded`,children:n.provider})]})},n.id))]})]}),e.jsxs("button",{onClick:()=>c(!h),className:`flex items-center space-x-2 px-3 py-1.5 rounded-lg transition duration-200 ${h?"bg-orange-500 text-white":`${t.bg.tertiary} ${t.text.secondary} ${t.interactive.hover}`}`,children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{children:"Ảnh"})]}),e.jsxs("button",{onClick:()=>S(!I),className:`flex items-center space-x-2 ${t.bg.tertiary} ${t.text.secondary} px-3 py-1.5 rounded-lg ${t.interactive.hover} transition duration-200`,children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx("span",{children:"Lịch sử"})]})]})]}),e.jsxs("div",{className:`text-sm ${t.text.secondary} mb-3`,children:["Đang sử dụng: ",e.jsx("span",{className:`font-medium ${t.text.accent}`,children:F(b)})]}),h&&e.jsxs("div",{className:"mt-3 p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:`font-semibold ${t.text.primary}`,children:"Upload & Phân tích ảnh"}),e.jsx("button",{onClick:()=>c(!1),className:`${t.text.secondary} ${t.interactive.hover}`,children:"×"})]}),e.jsx(Le,{selectedModel:b,onSendMessage:U})]}),I&&e.jsxs("div",{className:`mt-3 p-4 ${t.bg.tertiary} rounded-lg max-h-64 overflow-y-auto`,children:[e.jsxs("h3",{className:`font-semibold ${t.text.primary} mb-3`,children:["Lịch sử chat (",N.length,")"]}),N.length===0?e.jsx("p",{className:`${t.text.secondary} text-sm`,children:"Chưa có chat nào được lưu"}):e.jsx("div",{className:"space-y-2",children:N.slice().reverse().map(n=>{var x;return e.jsxs("div",{className:`flex items-center justify-between p-3 ${t.bg.primary} rounded border ${t.border.primary} ${t.interactive.hover} transition duration-200`,children:[e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>j(n),children:[e.jsx("div",{className:`font-medium ${t.text.primary} text-sm truncate`,children:n.title}),e.jsxs("div",{className:`text-xs ${t.text.secondary}`,children:[((x=n.messages)==null?void 0:x.length)||0," tin nhắn • ",F(n.model||"gpt-4o-mini")," • ",new Date(n.timestamp).toLocaleDateString("vi-VN")]})]}),e.jsx("button",{onClick:u=>{u.stopPropagation(),le(n.id)},className:"text-red-500 hover:text-red-700 p-1",children:e.jsx(D,{className:"h-4 w-4"})})]},n.id)})})]}),e.jsxs("div",{className:"flex space-x-2 mt-3",children:[e.jsxs("button",{onClick:L,className:"flex items-center space-x-2 bg-purple-500 text-white px-3 py-1.5 rounded-lg hover:bg-purple-600 transition duration-200",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:"Chat mới"})]}),e.jsxs("button",{onClick:q,disabled:r.length===0,className:"flex items-center space-x-2 bg-blue-500 text-white px-3 py-1.5 rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition duration-200",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{children:"Lưu"})]}),e.jsxs("button",{onClick:H,disabled:r.length===0,className:"flex items-center space-x-2 bg-green-500 text-white px-3 py-1.5 rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition duration-200",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:"Xuất"})]}),e.jsxs("button",{onClick:oe,disabled:r.length===0,className:"flex items-center space-x-2 bg-red-500 text-white px-3 py-1.5 rounded-lg hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed transition duration-200",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{children:"Xóa"})]})]})]}),e.jsxs("div",{className:`h-96 overflow-y-auto p-6 space-y-4 ${t.bg.primary}`,children:[r.length===0&&e.jsxs("div",{className:`text-center ${t.text.secondary} py-12`,children:[e.jsx(R,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Bắt đầu cuộc trò chuyện với AI của bạn!"}),e.jsx("p",{className:"text-xs mt-2",children:"💡 Lịch sử chat được tự động lưu"}),e.jsxs("p",{className:"text-xs mt-1",children:["🤖 Model hiện tại: ",e.jsx("span",{className:"font-medium",children:F(b)})]})]}),r.map((n,x)=>{var u;return e.jsx("div",{className:`flex ${n.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-3 rounded-2xl ${n.role==="user"?"bg-blue-500 text-white":n.isError?"bg-red-100 text-red-800 border border-red-200 dark:bg-red-900/20 dark:text-red-400 dark:border-red-800":`${t.bg.secondary} ${t.text.primary}`}`,children:[n.image&&e.jsxs("div",{className:"mb-2",children:[e.jsx("img",{src:n.image.url,alt:n.image.name,className:"max-w-full h-32 object-cover rounded-lg border"}),e.jsxs("p",{className:"text-xs opacity-70 mt-1",children:["📷 ",n.image.name]})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:n.content}),e.jsxs("div",{className:"flex justify-between items-center mt-2 text-xs opacity-70",children:[e.jsx("span",{children:new Date(n.timestamp).toLocaleTimeString("vi-VN")}),n.model&&n.role==="assistant"&&e.jsx("span",{className:"bg-white bg-opacity-20 px-2 py-1 rounded text-xs",children:((u=A.find(E=>E.id===n.model))==null?void 0:u.name)||n.model})]})]})},x)}),l&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:`${t.bg.secondary} px-4 py-3 rounded-2xl`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"h-4 w-4 animate-spin"}),e.jsxs("span",{className:`text-sm ${t.text.secondary}`,children:[F(b).split(" (")[0]," đang suy nghĩ..."]})]})})}),e.jsx("div",{ref:k})]}),e.jsxs("div",{className:`border-t ${t.border.primary} ${t.bg.secondary} p-4`,children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>c(!h),className:`p-2 rounded-lg transition duration-200 ${h?"bg-orange-500 text-white":`${t.bg.tertiary} ${t.text.secondary} ${t.interactive.hover}`}`,children:e.jsx(ye,{className:"h-5 w-5"})}),e.jsx("input",{type:"text",value:i,onChange:n=>o(n.target.value),onKeyPress:n=>n.key==="Enter"&&U(),placeholder:`Nhập tin nhắn cho ${F(b).split(" (")[0]}...`,className:`flex-1 border ${t.border.primary} rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none ${t.bg.primary} ${t.text.primary}`,disabled:l}),e.jsxs("button",{onClick:()=>U(),disabled:l||!i.trim(),className:"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition duration-200 flex items-center space-x-2",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{children:"Gửi"})]})]}),h&&e.jsx("div",{className:"mt-3 p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800",children:e.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300 mb-2",children:"💡 Tip: Upload ảnh để phân tích, OCR, hoặc hỏi về nội dung ảnh"})})]})]})},Me=()=>{B();const[r,s]=p.useState([]),[i,o]=p.useState(""),[l,m]=p.useState(!1),[d,f]=p.useState(!1);p.useEffect(()=>{b()},[]);const b=async()=>{try{const c=await window.puter.kv.get("generatedImages");c&&s(JSON.parse(c))}catch(c){console.error("Lỗi tải ảnh:",c)}},C=async()=>{var c,N,P;if(!(!i.trim()||l)){m(!0);try{console.log("Generating image with prompt:",i),console.log("Test mode:",d);let k,A=d;try{k=await window.puter.ai.txt2img(i,d)}catch(w){if(console.log("Generation failed:",w),((c=w.error)==null?void 0:c.code)==="insufficient_funds"&&!d)console.log("Insufficient funds, trying test mode..."),A=!0,k=await window.puter.ai.txt2img(i,!0),f(!0),alert("💡 Account credit low - switched to Test Mode for free image generation!");else throw w}console.log("Generated image element:",k);let T="";if(k&&k.src)T=k.src;else if(typeof k=="string")T=k;else throw new Error("Không thể lấy URL ảnh từ response");const a={id:Date.now(),prompt:i.substring(0,100),url:T,timestamp:new Date().toISOString(),generated:!0,testMode:A};console.log("Image data to save:",a);const y=[...r,a];s(y);try{await $(y),console.log("Images saved successfully")}catch(w){console.warn("Storage error, using memory only:",w),alert("⚠️ Ảnh được tạo thành công nhưng không thể lưu vào storage do kích thước quá lớn. Ảnh vẫn hiển thị trong session này. Hãy download ảnh để lưu trữ!")}o("")}catch(k){console.error("Lỗi tạo ảnh:",k);let A="Vui lòng thử lại!";((N=k.error)==null?void 0:N.code)==="insufficient_funds"?(A="Account credit không đủ. Vui lòng chuyển sang Test Mode hoặc nạp thêm credit.",f(!0)):(P=k.error)!=null&&P.message?A=k.error.message:k.message&&(A=k.message),alert(`❌ Lỗi tạo ảnh: ${A}`)}finally{m(!1)}}},$=async c=>{const P=c.slice(-3).map(T=>({id:T.id,prompt:String(T.prompt).substring(0,50),url:T.url.startsWith("data:")?"":T.url,timestamp:typeof T.timestamp=="string"?T.timestamp.substring(0,19):new Date(T.timestamp).toISOString().substring(0,19),generated:!0})).filter(T=>T.url&&!T.url.startsWith("data:"));if(P.length===0)throw console.log("No valid URLs to save (all are base64)"),new Error("Cannot save base64 images - too large for storage");const k=JSON.stringify(P),A=new Blob([k]).size/1024;if(console.log(`Attempting to save ${A.toFixed(2)}KB of image metadata for ${P.length} images`),A>300){const T=[P[P.length-1]],a=JSON.stringify(T),y=new Blob([a]).size/1024;if(console.log(`Reduced to ${y.toFixed(2)}KB with 1 image`),y>300)throw new Error("Even single image metadata too large");await window.puter.kv.set("generatedImages",a)}else await window.puter.kv.set("generatedImages",k)},M=async c=>{try{const N=r.filter(k=>k.id!==c);s(N),N.some(k=>k.url&&!k.url.startsWith("data:"))?await $(N):console.log("Only base64 images remaining - keeping in memory only")}catch(N){console.error("Lỗi xóa ảnh từ storage (nhưng đã xóa khỏi UI):",N)}},I=async c=>{try{const P=await(await fetch(c.url)).blob(),k=window.URL.createObjectURL(P),A=document.createElement("a");A.href=k,A.download=`generated-image-${c.id}.png`,document.body.appendChild(A),A.click(),document.body.removeChild(A),window.URL.revokeObjectURL(k)}catch(N){console.error("Lỗi download ảnh:",N),alert('Không thể download ảnh. Vui lòng right-click và "Save image as"')}},S=c=>{navigator.clipboard.writeText(c.url).then(()=>{alert("Đã copy URL ảnh!")}).catch(N=>{console.error("Lỗi copy URL:",N),prompt("Copy URL này:",c.url)})},h=c=>{window.open(c.url,"_blank")};return e.jsxs("div",{className:`${t.card} rounded-2xl shadow-lg overflow-hidden`,children:[e.jsx("div",{className:`border-b ${t.border.primary} ${t.bg.secondary} px-6 py-4`,children:e.jsx("h2",{className:`text-lg font-semibold ${t.text.primary}`,children:"Tạo ảnh với AI"})}),e.jsxs("div",{className:`p-6 ${t.bg.primary}`,children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 p-3 ${t.bg.secondary} rounded-lg`,children:[e.jsxs("div",{children:[e.jsx("h3",{className:`font-medium ${t.text.primary}`,children:"Generation Mode"}),e.jsx("p",{className:`text-sm ${t.text.secondary}`,children:d?"Test Mode - Free generation with sample images":"Production Mode - High quality images (uses credits)"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:c=>f(c.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 ${t.bg.tertiary} peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600`}),e.jsx("span",{className:`ml-3 text-sm font-medium ${t.text.primary}`,children:d?"Test":"Production"})]})]}),e.jsxs("div",{className:"flex space-x-3 mb-6",children:[e.jsx("input",{type:"text",value:i,onChange:c=>o(c.target.value),onKeyPress:c=>c.key==="Enter"&&C(),placeholder:"Mô tả ảnh bạn muốn tạo (VD: Một chú mèo dễ thương trong vườn hoa)",className:`flex-1 border ${t.border.primary} rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none ${t.bg.primary} ${t.text.primary}`,disabled:l}),e.jsxs("button",{onClick:C,disabled:l||!i.trim(),className:"bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed transition duration-200 flex items-center space-x-2",children:[l?e.jsx(_,{className:"h-4 w-4 animate-spin"}):e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{children:l?"Đang tạo...":"Tạo ảnh"})]})]}),e.jsxs("div",{className:`border rounded-lg p-4 mb-6 ${d?"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800":"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800"}`,children:[e.jsx("h3",{className:`font-medium mb-2 ${d?"text-blue-800 dark:text-blue-300":"text-yellow-800 dark:text-yellow-300"}`,children:d?"🧪 Test Mode Active":"💎 Production Mode"}),e.jsx("ul",{className:`text-sm space-y-1 ${d?"text-blue-700 dark:text-blue-400":"text-yellow-700 dark:text-yellow-400"}`,children:d?e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Free:"})," No credit cost"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Quality:"})," Sample/demo images"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Speed:"})," Fast generation"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Best for:"})," Testing prompts and layouts"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Quality:"})," High-resolution DALL-E images"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Cost:"})," Uses account credits"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Commercial:"})," Can be used commercially"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Auto-fallback:"})," Switches to test mode if credits low"]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(c=>e.jsxs("div",{className:`relative group ${t.bg.primary} border ${t.border.primary} rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200`,children:[e.jsx("img",{src:c.url,alt:c.prompt,className:"w-full h-48 object-cover",onError:N=>{console.error("Image load error for:",c.url),N.target.style.opacity="0.5",N.target.alt="Lỗi tải ảnh"}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition duration-200 flex items-center justify-center",children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition duration-200 flex space-x-2",children:[e.jsx("button",{onClick:()=>I(c),className:"bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition duration-200",title:"Download ảnh",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>h(c),className:"bg-green-500 text-white p-2 rounded-full hover:bg-green-600 transition duration-200",title:"Mở ảnh mới",children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>S(c),className:"bg-purple-500 text-white p-2 rounded-full hover:bg-purple-600 transition duration-200",title:"Copy URL",children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>M(c.id),className:"bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition duration-200",title:"Xóa ảnh",children:e.jsx(D,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:`text-sm ${t.text.secondary} line-clamp-2 mb-2`,children:c.prompt}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:`text-xs ${t.text.tertiary}`,children:[new Date(c.timestamp).toLocaleDateString("vi-VN")," • ",new Date(c.timestamp).toLocaleTimeString("vi-VN")]}),c.testMode&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-600 dark:bg-blue-900/50 dark:text-blue-400 px-2 py-1 rounded",children:"Test Mode"})]})]})]},c.id))}),r.length===0&&e.jsxs("div",{className:`text-center ${t.text.secondary} py-12`,children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg mb-2",children:"Chưa có ảnh nào được tạo"}),e.jsx("p",{className:"text-sm",children:'Nhập mô tả ảnh và bấm "Tạo ảnh" để bắt đầu'})]}),r.length>5&&e.jsx("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:["⚠️ ",e.jsx("strong",{children:"Lưu ý về Storage:"})," Do giới hạn lưu trữ, chỉ giữ tối đa 10 ảnh gần nhất. Hãy download ảnh quan trọng để lưu trữ lâu dài!"]})})]})]})},ie=p.createContext(),Ee=({children:r})=>{const[s,i]=p.useState(null),o=async l=>{try{await window.puter.kv.set("currentChatSession",JSON.stringify(l)),i(l),window.dispatchEvent(new CustomEvent("loadSavedChat",{detail:l}))}catch(m){console.error("Lỗi load chat:",m)}};return e.jsx(ie.Provider,{value:{currentChat:s,setCurrentChat:i,loadChatFromSaved:o},children:r})},Ge=()=>{var M,I,S;const{isDark:r}=B(),[s,i]=p.useState([]),[o,l]=p.useState(null),{loadChatFromSaved:m}=p.useContext(ie)||{};p.useEffect(()=>{d()},[]);const d=async()=>{try{const h=await window.puter.kv.get("savedChats");h&&i(JSON.parse(h))}catch(h){console.error("Lỗi tải chat:",h)}},f=async h=>{try{const c=s.filter(N=>N.id!==h);i(c),await window.puter.kv.set("savedChats",JSON.stringify(c))}catch(c){console.error("Lỗi xóa chat:",c)}},b=async h=>{try{m?(await m(h),alert(`Đã tải chat: "${h.title}". Chuyển sang tab Chat AI để xem!`)):(await window.puter.kv.set("currentChatSession",JSON.stringify(h)),window.location.reload())}catch(c){console.error("Lỗi tải chat:",c),alert("Có lỗi khi tải chat. Vui lòng thử lại!")}},C=h=>{l(h)},$=h=>({"gpt-4o":"GPT-4o","gpt-4o-mini":"GPT-4o Mini","gpt-4.1":"GPT-4.1","gpt-4.1-mini":"GPT-4.1 Mini","gpt-4.1-nano":"GPT-4.1 Nano","claude-sonnet-4":"Claude Sonnet 4","claude-opus-4":"Claude Opus 4","claude-3-5-sonnet":"Claude 3.5 Sonnet",claude:"Claude 3.7 Sonnet","google/gemini-2.5-flash":"Gemini 2.5 Flash","google/gemini-pro":"Gemini Pro","meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo":"Llama 3.1 70B",o1:"o1","o1-mini":"o1 Mini","o3-mini":"o3 Mini"})[h]||h;return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:`${t.card} rounded-2xl shadow-lg overflow-hidden`,children:[e.jsxs("div",{className:`border-b ${t.border.primary} ${t.bg.secondary} px-6 py-4 flex justify-between items-center`,children:[e.jsxs("h2",{className:`text-lg font-semibold ${t.text.primary}`,children:["Chat đã lưu (",s.length,")"]}),e.jsx("button",{onClick:d,className:`${t.text.accent} ${t.interactive.hover} text-sm`,children:"Làm mới"})]}),e.jsx("div",{className:`p-6 ${t.bg.primary}`,children:s.length===0?e.jsxs("div",{className:`text-center ${t.text.secondary} py-8`,children:[e.jsx(te,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Chưa có chat nào được lưu"})]}):e.jsx("div",{className:"space-y-3",children:s.slice().reverse().map(h=>{var c;return e.jsx("div",{className:`p-4 border ${t.border.primary} rounded-lg hover:shadow-md transition duration-200 cursor-pointer ${(o==null?void 0:o.id)===h.id?`border-blue-500 ${r?"bg-blue-900/20":"bg-blue-50"}`:`${t.interactive.hover}`}`,onClick:()=>C(h),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-medium ${t.text.primary} mb-2 line-clamp-2`,children:h.title}),e.jsxs("div",{className:`flex items-center space-x-4 text-sm ${t.text.secondary} mb-3`,children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs("span",{children:[((c=h.messages)==null?void 0:c.length)||0," tin nhắn"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:$(h.model||"gpt-4o-mini")})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx("span",{children:new Date(h.timestamp).toLocaleDateString("vi-VN")})]})]}),e.jsx("div",{className:`text-xs ${t.text.tertiary} ${t.bg.tertiary} p-2 rounded`,children:h.messages&&h.messages.length>0?`${h.messages[0].content.substring(0,80)}${h.messages[0].content.length>80?"...":""}`:"Không có tin nhắn"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 ml-4",children:[e.jsx("button",{onClick:N=>{N.stopPropagation(),b(h)},className:"bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition duration-200",children:"Tải"}),e.jsx("button",{onClick:N=>{N.stopPropagation(),f(h.id)},className:"bg-red-500 text-white p-1 rounded hover:bg-red-600 transition duration-200",children:e.jsx(D,{className:"h-4 w-4"})})]})]})},h.id)})})})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:`${t.card} rounded-2xl shadow-lg overflow-hidden h-fit sticky top-6`,children:[e.jsx("div",{className:`border-b ${t.border.primary} ${t.bg.secondary} px-6 py-4`,children:e.jsx("h3",{className:`text-lg font-semibold ${t.text.primary}`,children:"Preview Chat"})}),e.jsx("div",{className:`p-6 ${t.bg.primary}`,children:o?e.jsxs("div",{children:[e.jsx("h4",{className:`font-medium ${t.text.primary} mb-3`,children:o.title}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t.text.secondary,children:"Tin nhắn:"}),e.jsx("span",{className:`font-medium ${t.text.primary}`,children:((M=o.messages)==null?void 0:M.length)||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t.text.secondary,children:"Model:"}),e.jsx("span",{className:`font-medium ${t.text.primary}`,children:$(o.model||"gpt-4o-mini")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t.text.secondary,children:"Ngày tạo:"}),e.jsx("span",{className:`font-medium ${t.text.primary}`,children:new Date(o.timestamp).toLocaleDateString("vi-VN")})]})]}),e.jsxs("div",{className:`border-t ${t.border.primary} pt-4`,children:[e.jsx("h5",{className:`font-medium ${t.text.primary} mb-3`,children:"Nội dung chat:"}),e.jsxs("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:[(I=o.messages)==null?void 0:I.slice(0,6).map((h,c)=>e.jsxs("div",{className:`text-sm p-2 rounded ${h.role==="user"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":`${t.bg.secondary} ${t.text.primary}`}`,children:[e.jsxs("div",{className:"font-medium text-xs mb-1",children:[h.role==="user"?"👤 Bạn":"🤖 AI",h.model&&` (${$(h.model)})`]}),e.jsx("div",{className:"line-clamp-3",children:h.content})]},c)),((S=o.messages)==null?void 0:S.length)>6&&e.jsxs("div",{className:`text-center ${t.text.tertiary} text-xs`,children:["... và ",o.messages.length-6," tin nhắn khác"]})]})]}),e.jsx("button",{onClick:()=>b(o),className:"w-full mt-4 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-200",children:"Tải chat này"})]}):e.jsxs("div",{className:`text-center ${t.text.secondary} py-8`,children:[e.jsx(R,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Chọn một chat để xem preview"})]})})]})})]})},Z=({onSignIn:r,onSignOut:s,isSignedIn:i=!1})=>i?e.jsxs("button",{onClick:s,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition duration-200",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{children:"Đăng xuất"})]}):e.jsxs("button",{onClick:r,className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-blue-600 hover:to-purple-700 transition duration-300 transform hover:scale-105 shadow-lg",children:[e.jsx(ke,{className:"inline-block h-5 w-5 mr-2"}),"Đăng nhập với Puter"]}),Ue=()=>{const[r,s]=p.useState(null),[i,o]=p.useState(!0);return p.useEffect(()=>{const d=async()=>{if(window.puter)try{const f=await window.puter.auth.getUser();f&&s(f)}catch{console.log("User chưa đăng nhập")}o(!1)};if(window.puter)d();else{const f=setInterval(()=>{window.puter&&(clearInterval(f),d())},100)}},[]),{user:r,signIn:async()=>{try{const d=await window.puter.auth.signIn();return s(d),d}catch(d){throw console.error("Lỗi đăng nhập:",d),d}},signOut:async()=>{try{await window.puter.auth.signOut(),s(null)}catch(d){throw console.error("Lỗi đăng xuất:",d),d}},isLoading:i}},Re=r=>{p.useEffect(()=>{r.title&&(document.title=r.title);const s=(o,l,m=!1)=>{const d=m?`meta[property="${o}"]`:`meta[name="${o}"]`;let f=document.querySelector(d);f?f.setAttribute("content",l):(f=document.createElement("meta"),m?f.setAttribute("property",o):f.setAttribute("name",o),f.setAttribute("content",l),document.head.appendChild(f))};r.description&&s("description",r.description),r.keywords&&s("keywords",r.keywords),r.title&&s("og:title",r.title,!0),r.description&&s("og:description",r.description,!0),r.image&&s("og:image",r.image,!0),r.url&&s("og:url",r.url,!0),r.title&&s("twitter:title",r.title,!0),r.description&&s("twitter:description",r.description,!0),r.image&&s("twitter:image",r.image,!0),r.themeColor&&s("theme-color",r.themeColor);let i=document.querySelector('link[rel="canonical"]');if(i?i.setAttribute("href",window.location.href):(i=document.createElement("link"),i.setAttribute("rel","canonical"),i.setAttribute("href",window.location.href),document.head.appendChild(i)),r.structuredData){let o=document.querySelector('script[type="application/ld+json"]');o?o.textContent=JSON.stringify(r.structuredData):(o=document.createElement("script"),o.setAttribute("type","application/ld+json"),o.textContent=JSON.stringify(r.structuredData),document.head.appendChild(o))}},[r])},Fe=()=>{var M;const{user:r,signIn:s,signOut:i,isLoading:o}=Ue(),{isDark:l}=B(),[m,d]=p.useState("chat"),f=[{id:"chat",label:"Chat AI",icon:R,component:Oe},{id:"images",label:"Tạo Ảnh",icon:V,component:Me},{id:"saved",label:"Đã Lưu",icon:te,component:Ge}],C=(()=>{const I=window.location.origin,S=window.location.href;if(o)return{title:"Đang tải... - Puter AI Assistant",description:"Đang khởi tạo Puter AI Assistant...",keywords:"puter ai, loading, ai assistant",url:S,image:`${I}/og-image.png`,themeColor:l?"#1f2937":"#ffffff"};if(!r)return{title:"Đăng nhập - Puter AI Assistant",description:"Đăng nhập vào Puter AI Assistant để truy cập 25+ AI models miễn phí với lưu trữ cloud.",keywords:"puter ai, đăng nhập, ai assistant, chat ai, miễn phí",url:S,image:`${I}/og-image.png`,themeColor:l?"#1f2937":"#ffffff"};switch(m){case"chat":return{title:"Chat AI - Puter AI Assistant",description:"Trò chuyện với 25+ AI models như GPT-4, Claude, Gemini. Tự động lưu lịch sử, hỗ trợ upload file và phân tích ảnh.",keywords:"chat ai, gpt-4, claude, gemini, ai assistant, chatbot, artificial intelligence",url:S,image:`${I}/og-image-chat.png`,themeColor:l?"#1f2937":"#ffffff",structuredData:{"@context":"https://schema.org","@type":"SoftwareApplication",name:"Puter AI Chat",description:"Chat với 25+ AI models miễn phí",url:S,applicationCategory:"AI Chat Assistant",featureList:["GPT-4","Claude","Gemini","25+ AI Models"]}};case"images":return{title:"Tạo Ảnh AI - Puter AI Assistant",description:"Tạo ảnh nghệ thuật với AI sử dụng DALL-E. Miễn phí với Test Mode, chất lượng cao với Production Mode.",keywords:"tạo ảnh ai, dall-e, ai art, image generation, text to image, ai artwork",url:S,image:`${I}/og-image-art.png`,themeColor:l?"#1f2937":"#ffffff",structuredData:{"@context":"https://schema.org","@type":"SoftwareApplication",name:"Puter AI Image Generator",description:"Tạo ảnh nghệ thuật với AI",url:S,applicationCategory:"AI Image Generator",featureList:["DALL-E","Text to Image","AI Art Generation"]}};case"saved":return{title:"Dữ Liệu Đã Lưu - Puter AI Assistant",description:"Quản lý và xem lại tất cả cuộc trò chuyện AI đã lưu. Tự động đồng bộ với Puter Cloud.",keywords:"lưu trữ chat, quản lý dữ liệu, puter cloud, backup chat ai",url:S,image:`${I}/og-image.png`,themeColor:l?"#1f2937":"#ffffff"};default:return{title:"Puter AI Assistant - 25+ AI Models Miễn Phí",description:"Trợ lý AI toàn diện với 25+ models, tạo ảnh, chat thông minh và lưu trữ cloud miễn phí.",keywords:"puter ai, ai assistant, gpt-4, claude, gemini, ai models, miễn phí",url:S,image:`${I}/og-image.png`,themeColor:l?"#1f2937":"#ffffff",structuredData:{"@context":"https://schema.org","@type":"SoftwareApplication",name:"Puter AI Assistant",description:"Trợ lý AI toàn diện với 25+ models, tạo ảnh và lưu trữ cloud miễn phí",url:I,applicationCategory:"AI Assistant",operatingSystem:"Web Browser",offers:{"@type":"Offer",price:"0",priceCurrency:"USD"},author:{"@type":"Organization",name:"Puter AI Assistant"},featureList:["25+ AI Models","Chat với GPT-4, Claude, Gemini","Tạo ảnh với DALL-E","Tự động lưu lịch sử","Dark/Light theme","Upload và phân tích file","Đồng bộ cloud miễn phí"]}}}})();if(Re(C),o)return e.jsx("div",{className:`min-h-screen flex items-center justify-center ${t.gradient.primary}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:`${t.text.secondary}`,children:"Đang khởi tạo Puter AI..."})]})});if(!r)return e.jsx("div",{className:`min-h-screen ${t.gradient.primary} flex items-center justify-center p-4`,children:e.jsxs("div",{className:`${t.card} rounded-2xl shadow-2xl p-8 max-w-md w-full`,children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(Y,{})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-20 h-20 ${t.gradient.header} rounded-full flex items-center justify-center mx-auto mb-4`,children:e.jsx(R,{className:"h-10 w-10 text-white"})}),e.jsx("h1",{className:`text-3xl font-bold ${t.text.primary} mb-2`,children:"Puter AI Assistant"}),e.jsx("p",{className:`${t.text.secondary} mb-4`,children:"Trí tuệ nhân tạo với lưu trữ cloud miễn phí"}),e.jsxs("div",{className:`text-left ${t.bg.secondary} p-4 rounded-lg mb-6`,children:[e.jsx("h3",{className:`font-semibold ${t.text.primary} mb-2`,children:"Tính năng:"}),e.jsxs("ul",{className:`text-sm ${t.text.secondary} space-y-1`,children:[e.jsx("li",{children:"✨ 25+ AI models (GPT-4, Claude, Gemini, Llama...)"}),e.jsx("li",{children:"💾 Tự động lưu lịch sử chat"}),e.jsx("li",{children:"🎨 Tạo ảnh với DALL-E 3"}),e.jsx("li",{children:"📁 Upload & phân tích files (PDF, DOC, IMG...)"}),e.jsx("li",{children:"🌙 Dark/Light theme"}),e.jsx("li",{children:"☁️ Đồng bộ dữ liệu qua cloud"}),e.jsx("li",{children:"🆓 Hoàn toàn miễn phí"})]})]})]}),e.jsx(Z,{onSignIn:s})]})});const $=(M=f.find(I=>I.id===m))==null?void 0:M.component;return e.jsxs("div",{className:`min-h-screen ${t.bg.secondary}`,children:[e.jsx("header",{className:`${t.bg.primary} shadow-lg border-b ${t.border.primary}`,children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-8 h-8 ${t.gradient.header} rounded-full flex items-center justify-center`,children:e.jsx(R,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-xl font-bold ${t.text.primary}`,children:"Puter AI Assistant"}),e.jsx("p",{className:`text-xs ${t.text.tertiary}`,children:"25+ AI Models • Auto-save • Dark Mode • Free Forever"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Y,{}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:`text-sm ${t.text.secondary}`,children:["Xin chào, ",r.username||"User"]}),e.jsx("p",{className:`text-xs ${t.text.tertiary}`,children:"Puter Cloud Account"})]}),e.jsx(Z,{onSignOut:i,isSignedIn:!0})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("div",{className:`flex space-x-1 ${t.bg.tertiary} rounded-xl p-1 mb-6`,children:f.map(I=>{const S=I.icon;return e.jsxs("button",{onClick:()=>d(I.id),className:`flex items-center space-x-2 px-4 py-3 rounded-lg font-medium transition duration-200 ${m===I.id?`${t.bg.primary} ${t.text.accent} shadow-md transform scale-105`:`${t.text.secondary} ${t.interactive.hover}`}`,children:[e.jsx(S,{className:"h-5 w-5"}),e.jsx("span",{children:I.label}),I.id==="chat"&&e.jsx("span",{className:`${t.bg.accent} ${t.text.accent} text-xs px-2 py-1 rounded-full`,children:"25+ Models"})]},I.id)})}),e.jsx("div",{className:"animate-fade-in",children:$&&e.jsx($,{})}),e.jsxs("footer",{className:`mt-12 text-center ${t.text.tertiary} text-sm`,children:[e.jsxs("p",{children:["Powered by ",e.jsx("a",{href:"https://puter.com",target:"_blank",rel:"noopener noreferrer",className:`${t.text.accent} hover:underline`,children:"Puter.js"})," • User Pays Model • Privacy First"]}),e.jsx("p",{className:"mt-1",children:"No API keys required • Infinitely scalable • Open source"})]})]})]})};function De(){return p.useEffect(()=>{(()=>{if(document.documentElement.lang="vi",[{name:"robots",content:"index, follow"},{name:"language",content:"vi"},{name:"author",content:"Puter AI Assistant"},{name:"viewport",content:"width=device-width, initial-scale=1.0"},{property:"og:type",content:"website"},{property:"og:site_name",content:"Puter AI Assistant"},{property:"twitter:card",content:"summary_large_image"},{httpEquiv:"X-Content-Type-Options",content:"nosniff"},{httpEquiv:"X-Frame-Options",content:"DENY"},{httpEquiv:"X-XSS-Protection",content:"1; mode=block"}].forEach(i=>{const{name:o,property:l,httpEquiv:m,content:d}=i;let f="";if(o&&(f=`meta[name="${o}"]`),l&&(f=`meta[property="${l}"]`),m&&(f=`meta[http-equiv="${m}"]`),!document.querySelector(f)){const b=document.createElement("meta");o&&b.setAttribute("name",o),l&&b.setAttribute("property",l),m&&b.setAttribute("http-equiv",m),b.setAttribute("content",d),document.head.appendChild(b)}}),!document.querySelector('link[rel="icon"]')){const i=document.createElement("link");i.rel="icon",i.type="image/x-icon",i.href="/favicon.ico",document.head.appendChild(i)}if(!document.querySelector('link[rel="apple-touch-icon"]')){const i=document.createElement("link");i.rel="apple-touch-icon",i.href="/apple-touch-icon.png",document.head.appendChild(i)}})()},[]),e.jsx(Pe,{children:e.jsx(Ee,{children:e.jsx(Fe,{})})})}ne(document.getElementById("root")).render(e.jsx(p.StrictMode,{children:e.jsx(De,{})}));
