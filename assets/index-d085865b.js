import{r as g,a as ce}from"./vendor-30840fde.js";import{L as _,U as de,T as F,E as he,F as me,D as W,S as ue,M as pe,C as ee,a as ge,I as V,H as xe,b as R,c as ye,P as fe,d as be,e as we,f as ve,g as te,h as je,i as Ne,j as ke}from"./icons-0c6d1b93.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const h of o)if(h.type==="childList")for(const l of h.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function d(o){const h={};return o.integrity&&(h.integrity=o.integrity),o.referrerPolicy&&(h.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?h.credentials="include":o.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(o){if(o.ep)return;o.ep=!0;const h=d(o);fetch(o.href,h)}})();var re={exports:{}},J={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ce=g,$e=Symbol.for("react.element"),Ie=Symbol.for("react.fragment"),Ae=Object.prototype.hasOwnProperty,Se=Ce.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Te={key:!0,ref:!0,__self:!0,__source:!0};function se(r,s,d){var i,o={},h=null,l=null;d!==void 0&&(h=""+d),s.key!==void 0&&(h=""+s.key),s.ref!==void 0&&(l=s.ref);for(i in s)Ae.call(s,i)&&!Te.hasOwnProperty(i)&&(o[i]=s[i]);if(r&&r.defaultProps)for(i in s=r.defaultProps,s)o[i]===void 0&&(o[i]=s[i]);return{$$typeof:$e,type:r,key:h,ref:l,props:o,_owner:Se.current}}J.Fragment=Ie;J.jsx=se;J.jsxs=se;re.exports=J;var e=re.exports,ne,Q=ce;ne=Q.createRoot,Q.hydrateRoot;const Le=({selectedModel:r,onSendMessage:s})=>{const[d,i]=g.useState([]),[o,h]=g.useState(!1),[l,w]=g.useState(!1),[u,x]=g.useState(!1),$=g.useRef(null),M=a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?x(!0):a.type==="dragleave"&&x(!1)},I=a=>{a.preventDefault(),a.stopPropagation(),x(!1);const b=[...a.dataTransfer.files];m(b)},S=a=>{const b=[...a.target.files];m(b)},m=async a=>{const b=a.filter(v=>v.type.startsWith("image/"));if(b.length===0){alert("Vui lòng chọn file ảnh (JPG, PNG, GIF, WebP)");return}h(!0);for(const v of b)try{const y=URL.createObjectURL(v),N=await c(v),L=await window.puter.fs.upload([v]);console.log("Upload response:",L);let U="";Array.isArray(L)&&L.length>0?U=L[0].path||L[0].name:L.path?U=L.path:U=L.name||v.name;const q={id:Date.now()+Math.random(),name:v.name,size:v.size,type:v.type,previewUrl:y,filePath:U,base64:N,uploadedFile:L,uploadedAt:new Date};i(z=>[...z,q])}catch(y){console.error("Lỗi upload ảnh:",y),alert(`Lỗi upload ${v.name}: ${y.message}`)}h(!1)},c=a=>new Promise((b,v)=>{const y=new FileReader;y.readAsDataURL(a),y.onload=()=>b(y.result),y.onerror=N=>v(N)}),k=async(a,b="Hãy mô tả chi tiết những gì bạn thấy trong ảnh này")=>{var v;w(!0);try{const y=`${b}

[Phân tích ảnh: ${a.name}]`;console.log("Analyzing image with base64...");const N=await window.puter.ai.chat(y,a.base64,{model:r});let L="";typeof N=="string"?L=N:N&&N.message&&N.message.content?Array.isArray(N.message.content)?L=((v=N.message.content[0])==null?void 0:v.text)||N.message.content[0]:L=N.message.content:N&&N.content?L=N.content:L="AI đã phản hồi nhưng không thể hiển thị nội dung.",s&&s(y,L,a)}catch(y){console.error("Lỗi phân tích ảnh:",y);try{console.log("Trying fallback analysis...");const N=await window.puter.ai.chat(`Phân tích ảnh: ${a.name}. ${b}. 
          
          Lưu ý: Không thể tải ảnh trực tiếp, vui lòng mô tả nội dung ảnh này dựa trên tên file hoặc thử upload ảnh khác với định dạng JPG/PNG.`,{model:r});s&&s(`Phân tích ảnh: ${a.name}`,`⚠️ Không thể phân tích ảnh trực tiếp.

${N}`,a)}catch{s&&s(`Phân tích ảnh: ${a.name}`,`❌ Lỗi phân tích ảnh: ${y.message}

💡 Thử:
- Sử dụng ảnh định dạng JPG/PNG
- Chọn model khác (GPT-4o, Claude Vision)
- Upload ảnh kích thước nhỏ hơn`,a)}}finally{w(!1)}},P=async a=>{var b;w(!0);try{console.log("Extracting text using img2txt...");const y=await window.puter.ai.img2txt(a.base64)||"Không tìm thấy text trong ảnh",N=`Trích xuất text từ ảnh: ${a.name}`;s&&s(N,`**Text được trích xuất:**

${y}`,a)}catch(v){console.error("Lỗi OCR:",v);try{console.log("OCR failed, using vision model...");const y=await window.puter.ai.chat("Trích xuất tất cả text có trong ảnh này. Chỉ trả về text được tìm thấy, không thêm giải thích gì khác.",a.base64,{model:r});let N="";typeof y=="string"?N=y:y&&y.message&&y.message.content?N=Array.isArray(y.message.content)?((b=y.message.content[0])==null?void 0:b.text)||y.message.content[0]:y.message.content:N="Không thể trích xuất text bằng vision model",s&&s(`OCR ảnh: ${a.name}`,`**Text được trích xuất (via Vision):**

${N}`,a)}catch{s&&s(`OCR ảnh: ${a.name}`,`❌ Lỗi trích xuất text: ${v.message}

💡 Thử:
- Ảnh có text rõ ràng hơn
- Định dạng JPG/PNG
- Model khác có vision capability`,a)}}finally{w(!1)}},C=a=>{i(b=>{const v=b.filter(N=>N.id!==a),y=b.find(N=>N.id===a);return y!=null&&y.previewUrl&&URL.revokeObjectURL(y.previewUrl),v})},A=async a=>{try{const b=document.createElement("a");b.href=a.previewUrl,b.download=a.name,b.click()}catch(b){console.error("Lỗi download:",b)}},T=a=>{if(a===0)return"0 Bytes";const b=1024,v=["Bytes","KB","MB","GB"],y=Math.floor(Math.log(a)/Math.log(b));return parseFloat((a/Math.pow(b,y)).toFixed(2))+" "+v[y]};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition duration-200 ${u?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:M,onDragLeave:M,onDragOver:M,onDrop:I,children:[e.jsx("input",{ref:$,type:"file",multiple:!0,accept:"image/*",onChange:S,className:"hidden"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-center",children:o?e.jsx(_,{className:"h-10 w-10 text-blue-500 animate-spin"}):e.jsx(de,{className:"h-10 w-10 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 font-medium",children:o?"Đang upload...":"Upload ảnh để phân tích"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Kéo thả ảnh vào đây hoặc click để chọn file"}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Hỗ trợ: JPG, PNG, GIF, WebP • Tối đa 30MB"})]}),e.jsx("button",{onClick:()=>{var a;return(a=$.current)==null?void 0:a.click()},disabled:o,className:"bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 disabled:opacity-50 transition duration-200",children:"Chọn ảnh"})]})]}),d.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-800",children:["Ảnh đã upload (",d.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:d.map(a=>e.jsxs("div",{className:"border rounded-lg overflow-hidden bg-white shadow-sm",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a.previewUrl,alt:a.name,className:"w-full h-48 object-cover"}),e.jsx("button",{onClick:()=>C(a.id),className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full hover:bg-red-600 transition duration-200",children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"font-medium text-gray-800 truncate",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[T(a.size)," • ",new Date(a.uploadedAt).toLocaleString("vi-VN")]}),e.jsxs("div",{className:"flex space-x-2 mt-3",children:[e.jsxs("button",{onClick:()=>k(a),disabled:l,className:"flex items-center space-x-1 bg-purple-500 text-white px-3 py-1.5 rounded text-sm hover:bg-purple-600 disabled:opacity-50 transition duration-200",children:[l?e.jsx(_,{className:"h-4 w-4 animate-spin"}):e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{children:"Phân tích"})]}),e.jsxs("button",{onClick:()=>P(a),disabled:l,className:"flex items-center space-x-1 bg-green-500 text-white px-3 py-1.5 rounded text-sm hover:bg-green-600 disabled:opacity-50 transition duration-200",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:"OCR"})]}),e.jsx("button",{onClick:()=>A(a),className:"flex items-center space-x-1 bg-gray-500 text-white px-3 py-1.5 rounded text-sm hover:bg-gray-600 transition duration-200",children:e.jsx(W,{className:"h-4 w-4"})})]})]})]},a.id))})]}),d.length>0&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Phân tích nhanh"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[{label:"Mô tả chi tiết",prompt:"Hãy mô tả rất chi tiết những gì bạn thấy trong ảnh này, bao gồm màu sắc, đối tượng, bối cảnh và cảm xúc"},{label:"Trích xuất text",action:"ocr"},{label:"Phân tích biểu đồ",prompt:"Phân tích biểu đồ/chart trong ảnh này và giải thích ý nghĩa của dữ liệu"},{label:"Tìm lỗi code",prompt:"Kiểm tra code trong ảnh này và tìm ra các lỗi hoặc cải tiến có thể"}].map((a,b)=>e.jsx("button",{onClick:()=>{const v=d[d.length-1];a.action==="ocr"?P(v):k(v,a.prompt)},disabled:l||d.length===0,className:"bg-white border border-gray-200 text-gray-700 px-3 py-2 rounded text-sm hover:bg-gray-50 disabled:opacity-50 transition duration-200",children:a.label},b))})]})]})},ae=g.createContext(),B=()=>{const r=g.useContext(ae);if(!r)throw new Error("useTheme must be used within ThemeProvider");return r},Pe=({children:r})=>{const[s,d]=g.useState("light"),[i,o]=g.useState(!0);g.useEffect(()=>{h()},[]),g.useEffect(()=>{s==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[s]);const h=async()=>{try{if(window.puter){const $=await window.puter.kv.get("userTheme");if($){d($),o(!1);return}}const x=localStorage.getItem("theme");if(x)d(x);else{const $=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";d($)}}catch(x){console.error("Error loading theme:",x);const $=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";d($)}finally{o(!1)}},u={theme:s,toggleTheme:async()=>{const x=s==="light"?"dark":"light";d(x);try{window.puter&&await window.puter.kv.set("userTheme",x),localStorage.setItem("theme",x)}catch($){console.error("Error saving theme:",$),localStorage.setItem("theme",x)}},setTheme:async x=>{d(x);try{window.puter&&await window.puter.kv.set("userTheme",x),localStorage.setItem("theme",x)}catch($){console.error("Error saving theme:",$),localStorage.setItem("theme",x)}},isLoading:i,isDark:s==="dark"};return e.jsx(ae.Provider,{value:u,children:r})},Y=({className:r=""})=>{const{theme:s,toggleTheme:d,isLoading:i}=B();return i?e.jsx("div",{className:`w-10 h-10 rounded-lg bg-gray-200 dark:bg-gray-700 animate-pulse ${r}`}):e.jsx("button",{onClick:d,className:`flex items-center justify-center w-10 h-10 rounded-lg transition-all duration-200 hover:scale-105 ${s==="dark"?"bg-yellow-500 text-yellow-900 hover:bg-yellow-400":"bg-slate-700 text-slate-100 hover:bg-slate-600"} ${r}`,title:s==="dark"?"Chuyển sang Light Mode":"Chuyển sang Dark Mode",children:s==="dark"?e.jsx(ue,{className:"h-5 w-5"}):e.jsx(pe,{className:"h-5 w-5"})})},t={bg:{primary:"bg-white dark:bg-gray-900",secondary:"bg-gray-50 dark:bg-gray-800",tertiary:"bg-gray-100 dark:bg-gray-700",accent:"bg-blue-50 dark:bg-blue-900/20",surface:"bg-white dark:bg-gray-800",overlay:"bg-black/50 dark:bg-black/70"},text:{primary:"text-gray-900 dark:text-gray-100",secondary:"text-gray-600 dark:text-gray-300",tertiary:"text-gray-500 dark:text-gray-400",muted:"text-gray-400 dark:text-gray-500",accent:"text-blue-600 dark:text-blue-400",success:"text-green-600 dark:text-green-400",warning:"text-yellow-600 dark:text-yellow-400",danger:"text-red-600 dark:text-red-400"},border:{primary:"border-gray-200 dark:border-gray-700",secondary:"border-gray-300 dark:border-gray-600",accent:"border-blue-200 dark:border-blue-700",focus:"border-blue-500 dark:border-blue-400"},interactive:{hover:"hover:bg-gray-50 dark:hover:bg-gray-700",active:"active:bg-gray-100 dark:active:bg-gray-600",focus:"focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400",disabled:"disabled:opacity-50 disabled:cursor-not-allowed"},button:{primary:"bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 text-white",secondary:"bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200",success:"bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 text-white",warning:"bg-yellow-500 hover:bg-yellow-600 dark:bg-yellow-600 dark:hover:bg-yellow-700 text-white",danger:"bg-red-500 hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700 text-white"},card:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-sm dark:shadow-gray-900/10",input:"bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400",gradient:{primary:"bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 dark:from-gray-900 dark:via-blue-900/20 dark:to-purple-900/20",header:"bg-gradient-to-r from-blue-500 to-purple-600 dark:from-blue-600 dark:to-purple-700"}},Oe=()=>{B();const[r,s]=g.useState([]),[d,i]=g.useState(""),[o,h]=g.useState(!1),[l,w]=g.useState(null),[u,x]=g.useState("gpt-4o-mini"),[$,M]=g.useState(!1),[I,S]=g.useState(!1),[m,c]=g.useState(!1),[k,P]=g.useState([]),C=g.useRef(null),A=[{id:"gpt-4o",name:"GPT-4o",provider:"OpenAI",description:"Most capable GPT-4 model"},{id:"gpt-4o-mini",name:"GPT-4o Mini",provider:"OpenAI",description:"Faster, cheaper GPT-4o"},{id:"gpt-4.1",name:"GPT-4.1",provider:"OpenAI",description:"Latest GPT-4 iteration"},{id:"gpt-4.1-mini",name:"GPT-4.1 Mini",provider:"OpenAI",description:"Efficient GPT-4.1"},{id:"gpt-4.1-nano",name:"GPT-4.1 Nano",provider:"OpenAI",description:"Ultra-fast GPT-4.1"},{id:"gpt-4.5-preview",name:"GPT-4.5 Preview",provider:"OpenAI",description:"Next-gen preview"},{id:"o1",name:"o1",provider:"OpenAI",description:"Reasoning model"},{id:"o1-mini",name:"o1 Mini",provider:"OpenAI",description:"Efficient reasoning"},{id:"o1-pro",name:"o1 Pro",provider:"OpenAI",description:"Advanced reasoning"},{id:"o3",name:"o3",provider:"OpenAI",description:"Latest reasoning model"},{id:"o3-mini",name:"o3 Mini",provider:"OpenAI",description:"Fast reasoning"},{id:"o4-mini",name:"o4 Mini",provider:"OpenAI",description:"Next-gen reasoning"},{id:"claude-sonnet-4",name:"Claude Sonnet 4",provider:"Anthropic",description:"Latest Claude model"},{id:"claude-opus-4",name:"Claude Opus 4",provider:"Anthropic",description:"Most capable Claude"},{id:"claude-3-5-sonnet",name:"Claude 3.5 Sonnet",provider:"Anthropic",description:"Balanced Claude model"},{id:"claude",name:"Claude 3.7 Sonnet",provider:"Anthropic",description:"Enhanced Claude"},{id:"google/gemini-2.5-flash",name:"Gemini 2.5 Flash",provider:"Google",description:"Fast Google model"},{id:"google/gemini-pro",name:"Gemini Pro",provider:"Google",description:"Google's flagship model"},{id:"meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo",name:"Llama 3.1 70B Turbo",provider:"Meta",description:"Large open-source model"},{id:"meta-llama/llama-3.2-11b-vision-instruct",name:"Llama 3.2 11B Vision",provider:"Meta",description:"Vision-capable Llama"},{id:"openrouter:anthropic/claude-sonnet-4",name:"Claude Sonnet 4 (OpenRouter)",provider:"OpenRouter",description:"Claude via OpenRouter"},{id:"openrouter:google/gemini-pro-vision",name:"Gemini Pro Vision (OpenRouter)",provider:"OpenRouter",description:"Vision Gemini via OpenRouter"}];g.useEffect(()=>{T()},[r]),g.useEffect(()=>{a(),b()},[]),g.useEffect(()=>{r.length>0&&v()},[r]);const T=()=>{var n;(n=C.current)==null||n.scrollIntoView({behavior:"smooth"})},a=async()=>{try{const n=await window.puter.kv.get("savedChats");n&&P(JSON.parse(n))}catch(n){console.error("Lỗi tải lịch sử chat:",n)}},b=async()=>{try{const n=await window.puter.kv.get("currentChatSession");if(n){const f=JSON.parse(n);s(f.messages||[]),w(f.id),f.model&&x(f.model)}}catch(n){console.error("Lỗi tải session hiện tại:",n)}},v=async()=>{var n,f;try{if(!l){const E=Date.now();w(E)}const p={id:l||Date.now(),messages:r,model:u,lastUpdated:new Date,title:((f=(n=r[0])==null?void 0:n.content)==null?void 0:f.substring(0,50))+"..."||"Cuộc trò chuyện"};await window.puter.kv.set("currentChatSession",JSON.stringify(p)),r.length%5===0&&r.length>0&&await y(p)}catch(p){console.error("Lỗi auto-save:",p)}},y=async n=>{try{const f=await window.puter.kv.get("savedChats"),p=f?JSON.parse(f):[],E=p.findIndex(H=>H.id===n.id);E>=0?p[E]={...n,timestamp:new Date}:p.push({...n,timestamp:new Date}),p.length>50&&p.splice(0,p.length-50),await window.puter.kv.set("savedChats",JSON.stringify(p)),P(p)}catch(f){console.error("Lỗi lưu vào lịch sử:",f)}},N=async n=>{var f,p;try{if(r.length>0&&l){const E={id:l,messages:r,model:u,timestamp:new Date,title:((p=(f=r[0])==null?void 0:f.content)==null?void 0:p.substring(0,50))+"..."||"Cuộc trò chuyện"};await y(E)}s(n.messages||[]),w(n.id),x(n.model||"gpt-4o-mini"),S(!1),await window.puter.kv.set("currentChatSession",JSON.stringify(n))}catch(E){console.error("Lỗi tải chat:",E)}},L=async()=>{var n,f;try{if(r.length>0&&l){const p={id:l,messages:r,model:u,timestamp:new Date,title:((f=(n=r[0])==null?void 0:n.content)==null?void 0:f.substring(0,50))+"..."||"Cuộc trò chuyện"};await y(p)}await window.puter.kv.del("currentChatSession"),s([]),w(null)}catch(p){console.error("Lỗi tạo chat mới:",p)}},U=async(n=null,f=null,p=null)=>{var X;const E=n||d;if(!E.trim()||o)return;const H={role:"user",content:E,timestamp:new Date,image:p?{name:p.name,url:p.previewUrl}:null};if(s(j=>[...j,H]),n||i(""),f){const j={role:"assistant",content:f,timestamp:new Date,model:u};s(O=>[...O,j]);return}h(!0);try{console.log("Sending to model:",u);const j=await window.puter.ai.chat(E,{model:u,stream:!1});console.log("AI Response:",j),console.log("AI Response type:",typeof j);let O="";if(typeof j=="string")O=j;else if(j&&j.message&&j.message.content)Array.isArray(j.message.content)?O=((X=j.message.content[0])==null?void 0:X.text)||j.message.content[0]:O=j.message.content;else if(j&&j.content)O=j.content;else if(j&&j.message&&typeof j.message=="string")O=j.message;else if(j&&j.text)O=j.text;else if(Array.isArray(j)&&j.length>0){const G=j[0];G&&G.message&&G.message.content?O=G.message.content:G&&G.content?O=G.content:G&&typeof G=="string"&&(O=G)}else j&&typeof j=="object"?(console.error("Unhandled response format:",j),O=`Response from ${u}: ${JSON.stringify(j,null,2)}`):O="AI đã phản hồi nhưng không thể hiển thị nội dung.";const K={role:"assistant",content:O,timestamp:new Date,model:u};s(G=>[...G,K])}catch(j){console.error("Lỗi chat AI:",j);const O={role:"assistant",content:`Xin lỗi, đã có lỗi khi sử dụng model ${u}. Vui lòng thử model khác hoặc thử lại!`,timestamp:new Date,isError:!0};s(K=>[...K,O])}finally{h(!1)}},q=async()=>{var n,f;if(r.length!==0)try{const p={id:l||Date.now(),title:((f=(n=r[0])==null?void 0:n.content)==null?void 0:f.substring(0,50))+"..."||"Cuộc trò chuyện",messages:r,model:u,timestamp:new Date};await y(p),alert("Chat đã được lưu vào lịch sử!")}catch(p){console.error("Lỗi lưu chat:",p),alert("Có lỗi khi lưu chat. Vui lòng thử lại!")}},z=async()=>{if(r.length===0)return;const n=r.map(p=>`[${p.role.toUpperCase()}${p.model?` - ${p.model}`:""}]: ${p.content}`).join(`

`),f=`chat_${u}_${new Date().getTime()}.txt`;try{await window.puter.fs.write(f,n),alert(`Chat đã được lưu thành file: ${f}`)}catch(p){console.error("Lỗi xuất chat:",p),alert("Có lỗi khi xuất file. Vui lòng thử lại!")}},oe=()=>{L()},le=async n=>{try{const f=k.filter(p=>p.id!==n);P(f),await window.puter.kv.set("savedChats",JSON.stringify(f))}catch(f){console.error("Lỗi xóa chat:",f)}},D=n=>{const f=A.find(p=>p.id===n);return f?`${f.name} (${f.provider})`:n};return e.jsxs("div",{className:`${t.card} rounded-2xl shadow-lg overflow-hidden`,children:[e.jsxs("div",{className:`border-b ${t.border.primary} ${t.bg.secondary} px-6 py-4`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:`text-lg font-semibold ${t.text.primary}`,children:"Trò chuyện với AI"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>M(!$),className:`flex items-center space-x-2 ${t.bg.accent} ${t.text.accent} px-3 py-1.5 rounded-lg ${t.interactive.hover} transition duration-200`,children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:D(u).split(" (")[0]}),e.jsx(ge,{className:"h-4 w-4"})]}),$&&e.jsxs("div",{className:`absolute right-0 top-full mt-2 w-80 ${t.bg.primary} ${t.border.primary} border rounded-lg shadow-lg z-50 max-h-96 overflow-y-auto`,children:[e.jsx("div",{className:`p-3 border-b ${t.border.primary} ${t.bg.secondary}`,children:e.jsx("h3",{className:`font-semibold ${t.text.primary}`,children:"Chọn AI Model"})}),A.map(n=>e.jsx("button",{onClick:()=>{x(n.id),M(!1)},className:`w-full text-left px-4 py-3 ${t.interactive.hover} border-b ${t.border.primary} ${u===n.id?`${t.bg.tertiary} border-l-4 border-l-blue-500`:""}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:`font-medium ${t.text.primary}`,children:n.name}),e.jsx("div",{className:`text-sm ${t.text.secondary}`,children:n.description})]}),e.jsx("span",{className:`text-xs ${t.bg.tertiary} ${t.text.secondary} px-2 py-1 rounded`,children:n.provider})]})},n.id))]})]}),e.jsxs("button",{onClick:()=>c(!m),className:`flex items-center space-x-2 px-3 py-1.5 rounded-lg transition duration-200 ${m?"bg-orange-500 text-white":`${t.bg.tertiary} ${t.text.secondary} ${t.interactive.hover}`}`,children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{children:"Ảnh"})]}),e.jsxs("button",{onClick:()=>S(!I),className:`flex items-center space-x-2 ${t.bg.tertiary} ${t.text.secondary} px-3 py-1.5 rounded-lg ${t.interactive.hover} transition duration-200`,children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx("span",{children:"Lịch sử"})]})]})]}),e.jsxs("div",{className:`text-sm ${t.text.secondary} mb-3`,children:["Đang sử dụng: ",e.jsx("span",{className:`font-medium ${t.text.accent}`,children:D(u)})]}),m&&e.jsxs("div",{className:"mt-3 p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:`font-semibold ${t.text.primary}`,children:"Upload & Phân tích ảnh"}),e.jsx("button",{onClick:()=>c(!1),className:`${t.text.secondary} ${t.interactive.hover}`,children:"×"})]}),e.jsx(Le,{selectedModel:u,onSendMessage:U})]}),I&&e.jsxs("div",{className:`mt-3 p-4 ${t.bg.tertiary} rounded-lg max-h-64 overflow-y-auto`,children:[e.jsxs("h3",{className:`font-semibold ${t.text.primary} mb-3`,children:["Lịch sử chat (",k.length,")"]}),k.length===0?e.jsx("p",{className:`${t.text.secondary} text-sm`,children:"Chưa có chat nào được lưu"}):e.jsx("div",{className:"space-y-2",children:k.slice().reverse().map(n=>{var f;return e.jsxs("div",{className:`flex items-center justify-between p-3 ${t.bg.primary} rounded border ${t.border.primary} ${t.interactive.hover} transition duration-200`,children:[e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>N(n),children:[e.jsx("div",{className:`font-medium ${t.text.primary} text-sm truncate`,children:n.title}),e.jsxs("div",{className:`text-xs ${t.text.secondary}`,children:[((f=n.messages)==null?void 0:f.length)||0," tin nhắn • ",D(n.model||"gpt-4o-mini")," • ",new Date(n.timestamp).toLocaleDateString("vi-VN")]})]}),e.jsx("button",{onClick:p=>{p.stopPropagation(),le(n.id)},className:"text-red-500 hover:text-red-700 p-1",children:e.jsx(F,{className:"h-4 w-4"})})]},n.id)})})]}),e.jsxs("div",{className:"flex space-x-2 mt-3",children:[e.jsxs("button",{onClick:L,className:"flex items-center space-x-2 bg-purple-500 text-white px-3 py-1.5 rounded-lg hover:bg-purple-600 transition duration-200",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{children:"Chat mới"})]}),e.jsxs("button",{onClick:q,disabled:r.length===0,className:"flex items-center space-x-2 bg-blue-500 text-white px-3 py-1.5 rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition duration-200",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx("span",{children:"Lưu"})]}),e.jsxs("button",{onClick:z,disabled:r.length===0,className:"flex items-center space-x-2 bg-green-500 text-white px-3 py-1.5 rounded-lg hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed transition duration-200",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:"Xuất"})]}),e.jsxs("button",{onClick:oe,disabled:r.length===0,className:"flex items-center space-x-2 bg-red-500 text-white px-3 py-1.5 rounded-lg hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed transition duration-200",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{children:"Xóa"})]})]})]}),e.jsxs("div",{className:`h-96 overflow-y-auto p-6 space-y-4 ${t.bg.primary}`,children:[r.length===0&&e.jsxs("div",{className:`text-center ${t.text.secondary} py-12`,children:[e.jsx(R,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Bắt đầu cuộc trò chuyện với AI của bạn!"}),e.jsx("p",{className:"text-xs mt-2",children:"💡 Lịch sử chat được tự động lưu"}),e.jsxs("p",{className:"text-xs mt-1",children:["🤖 Model hiện tại: ",e.jsx("span",{className:"font-medium",children:D(u)})]})]}),r.map((n,f)=>{var p;return e.jsx("div",{className:`flex ${n.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-3 rounded-2xl ${n.role==="user"?"bg-blue-500 text-white":n.isError?"bg-red-100 text-red-800 border border-red-200 dark:bg-red-900/20 dark:text-red-400 dark:border-red-800":`${t.bg.secondary} ${t.text.primary}`}`,children:[n.image&&e.jsxs("div",{className:"mb-2",children:[e.jsx("img",{src:n.image.url,alt:n.image.name,className:"max-w-full h-32 object-cover rounded-lg border"}),e.jsxs("p",{className:"text-xs opacity-70 mt-1",children:["📷 ",n.image.name]})]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:n.content}),e.jsxs("div",{className:"flex justify-between items-center mt-2 text-xs opacity-70",children:[e.jsx("span",{children:new Date(n.timestamp).toLocaleTimeString("vi-VN")}),n.model&&n.role==="assistant"&&e.jsx("span",{className:"bg-white bg-opacity-20 px-2 py-1 rounded text-xs",children:((p=A.find(E=>E.id===n.model))==null?void 0:p.name)||n.model})]})]})},f)}),o&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:`${t.bg.secondary} px-4 py-3 rounded-2xl`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"h-4 w-4 animate-spin"}),e.jsxs("span",{className:`text-sm ${t.text.secondary}`,children:[D(u).split(" (")[0]," đang suy nghĩ..."]})]})})}),e.jsx("div",{ref:C})]}),e.jsxs("div",{className:`border-t ${t.border.primary} ${t.bg.secondary} p-4`,children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>c(!m),className:`p-2 rounded-lg transition duration-200 ${m?"bg-orange-500 text-white":`${t.bg.tertiary} ${t.text.secondary} ${t.interactive.hover}`}`,children:e.jsx(fe,{className:"h-5 w-5"})}),e.jsx("input",{type:"text",value:d,onChange:n=>i(n.target.value),onKeyPress:n=>n.key==="Enter"&&U(),placeholder:`Nhập tin nhắn cho ${D(u).split(" (")[0]}...`,className:`flex-1 border ${t.border.primary} rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none ${t.bg.primary} ${t.text.primary}`,disabled:o}),e.jsxs("button",{onClick:()=>U(),disabled:o||!d.trim(),className:"bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition duration-200 flex items-center space-x-2",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{children:"Gửi"})]})]}),m&&e.jsx("div",{className:"mt-3 p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800",children:e.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300 mb-2",children:"💡 Tip: Upload ảnh để phân tích, OCR, hoặc hỏi về nội dung ảnh"})})]})]})},Me=()=>{B();const[r,s]=g.useState([]),[d,i]=g.useState(""),[o,h]=g.useState(!1),[l,w]=g.useState(!1);g.useEffect(()=>{u()},[]);const u=async()=>{try{const c=await window.puter.kv.get("generatedImages");c&&s(JSON.parse(c))}catch(c){console.error("Lỗi tải ảnh:",c)}},x=async()=>{var c,k,P;if(!(!d.trim()||o)){h(!0);try{console.log("Generating image with prompt:",d),console.log("Test mode:",l);let C,A=l;try{C=await window.puter.ai.txt2img(d,l)}catch(v){if(console.log("Generation failed:",v),((c=v.error)==null?void 0:c.code)==="insufficient_funds"&&!l)console.log("Insufficient funds, trying test mode..."),A=!0,C=await window.puter.ai.txt2img(d,!0),w(!0),alert("💡 Account credit low - switched to Test Mode for free image generation!");else throw v}console.log("Generated image element:",C);let T="";if(C&&C.src)T=C.src;else if(typeof C=="string")T=C;else throw new Error("Không thể lấy URL ảnh từ response");const a={id:Date.now(),prompt:d.substring(0,100),url:T,timestamp:new Date().toISOString(),generated:!0,testMode:A};console.log("Image data to save:",a);const b=[...r,a];s(b);try{await $(b),console.log("Images saved successfully")}catch(v){console.warn("Storage error, using memory only:",v),alert("⚠️ Ảnh được tạo thành công nhưng không thể lưu vào storage do kích thước quá lớn. Ảnh vẫn hiển thị trong session này. Hãy download ảnh để lưu trữ!")}i("")}catch(C){console.error("Lỗi tạo ảnh:",C);let A="Vui lòng thử lại!";((k=C.error)==null?void 0:k.code)==="insufficient_funds"?(A="Account credit không đủ. Vui lòng chuyển sang Test Mode hoặc nạp thêm credit.",w(!0)):(P=C.error)!=null&&P.message?A=C.error.message:C.message&&(A=C.message),alert(`❌ Lỗi tạo ảnh: ${A}`)}finally{h(!1)}}},$=async c=>{const P=c.slice(-3).map(T=>({id:T.id,prompt:String(T.prompt).substring(0,50),url:T.url.startsWith("data:")?"":T.url,timestamp:typeof T.timestamp=="string"?T.timestamp.substring(0,19):new Date(T.timestamp).toISOString().substring(0,19),generated:!0})).filter(T=>T.url&&!T.url.startsWith("data:"));if(P.length===0)throw console.log("No valid URLs to save (all are base64)"),new Error("Cannot save base64 images - too large for storage");const C=JSON.stringify(P),A=new Blob([C]).size/1024;if(console.log(`Attempting to save ${A.toFixed(2)}KB of image metadata for ${P.length} images`),A>300){const T=[P[P.length-1]],a=JSON.stringify(T),b=new Blob([a]).size/1024;if(console.log(`Reduced to ${b.toFixed(2)}KB with 1 image`),b>300)throw new Error("Even single image metadata too large");await window.puter.kv.set("generatedImages",a)}else await window.puter.kv.set("generatedImages",C)},M=async c=>{try{const k=r.filter(C=>C.id!==c);s(k),k.some(C=>C.url&&!C.url.startsWith("data:"))?await $(k):console.log("Only base64 images remaining - keeping in memory only")}catch(k){console.error("Lỗi xóa ảnh từ storage (nhưng đã xóa khỏi UI):",k)}},I=async c=>{try{const P=await(await fetch(c.url)).blob(),C=window.URL.createObjectURL(P),A=document.createElement("a");A.href=C,A.download=`generated-image-${c.id}.png`,document.body.appendChild(A),A.click(),document.body.removeChild(A),window.URL.revokeObjectURL(C)}catch(k){console.error("Lỗi download ảnh:",k),alert('Không thể download ảnh. Vui lòng right-click và "Save image as"')}},S=c=>{navigator.clipboard.writeText(c.url).then(()=>{alert("Đã copy URL ảnh!")}).catch(k=>{console.error("Lỗi copy URL:",k),prompt("Copy URL này:",c.url)})},m=c=>{window.open(c.url,"_blank")};return e.jsxs("div",{className:`${t.card} rounded-2xl shadow-lg overflow-hidden`,children:[e.jsx("div",{className:`border-b ${t.border.primary} ${t.bg.secondary} px-6 py-4`,children:e.jsx("h2",{className:`text-lg font-semibold ${t.text.primary}`,children:"Tạo ảnh với AI"})}),e.jsxs("div",{className:`p-6 ${t.bg.primary}`,children:[e.jsxs("div",{className:`flex items-center justify-between mb-4 p-3 ${t.bg.secondary} rounded-lg`,children:[e.jsxs("div",{children:[e.jsx("h3",{className:`font-medium ${t.text.primary}`,children:"Generation Mode"}),e.jsx("p",{className:`text-sm ${t.text.secondary}`,children:l?"Test Mode - Free generation with sample images":"Production Mode - High quality images (uses credits)"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:c=>w(c.target.checked),className:"sr-only peer"}),e.jsx("div",{className:`w-11 h-6 ${t.bg.tertiary} peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600`}),e.jsx("span",{className:`ml-3 text-sm font-medium ${t.text.primary}`,children:l?"Test":"Production"})]})]}),e.jsxs("div",{className:"flex space-x-3 mb-6",children:[e.jsx("input",{type:"text",value:d,onChange:c=>i(c.target.value),onKeyPress:c=>c.key==="Enter"&&x(),placeholder:"Mô tả ảnh bạn muốn tạo (VD: Một chú mèo dễ thương trong vườn hoa)",className:`flex-1 border ${t.border.primary} rounded-lg px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none ${t.bg.primary} ${t.text.primary}`,disabled:o}),e.jsxs("button",{onClick:x,disabled:o||!d.trim(),className:"bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed transition duration-200 flex items-center space-x-2",children:[o?e.jsx(_,{className:"h-4 w-4 animate-spin"}):e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{children:o?"Đang tạo...":"Tạo ảnh"})]})]}),e.jsxs("div",{className:`border rounded-lg p-4 mb-6 ${l?"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800":"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800"}`,children:[e.jsx("h3",{className:`font-medium mb-2 ${l?"text-blue-800 dark:text-blue-300":"text-yellow-800 dark:text-yellow-300"}`,children:l?"🧪 Test Mode Active":"💎 Production Mode"}),e.jsx("ul",{className:`text-sm space-y-1 ${l?"text-blue-700 dark:text-blue-400":"text-yellow-700 dark:text-yellow-400"}`,children:l?e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Free:"})," No credit cost"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Quality:"})," Sample/demo images"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Speed:"})," Fast generation"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Best for:"})," Testing prompts and layouts"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Quality:"})," High-resolution DALL-E images"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Cost:"})," Uses account credits"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Commercial:"})," Can be used commercially"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Auto-fallback:"})," Switches to test mode if credits low"]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(c=>e.jsxs("div",{className:`relative group ${t.bg.primary} border ${t.border.primary} rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-200`,children:[e.jsx("img",{src:c.url,alt:c.prompt,className:"w-full h-48 object-cover",onError:k=>{console.error("Image load error for:",c.url),k.target.style.opacity="0.5",k.target.alt="Lỗi tải ảnh"}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition duration-200 flex items-center justify-center",children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition duration-200 flex space-x-2",children:[e.jsx("button",{onClick:()=>I(c),className:"bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition duration-200",title:"Download ảnh",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>m(c),className:"bg-green-500 text-white p-2 rounded-full hover:bg-green-600 transition duration-200",title:"Mở ảnh mới",children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>S(c),className:"bg-purple-500 text-white p-2 rounded-full hover:bg-purple-600 transition duration-200",title:"Copy URL",children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>M(c.id),className:"bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition duration-200",title:"Xóa ảnh",children:e.jsx(F,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:`text-sm ${t.text.secondary} line-clamp-2 mb-2`,children:c.prompt}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:`text-xs ${t.text.tertiary}`,children:[new Date(c.timestamp).toLocaleDateString("vi-VN")," • ",new Date(c.timestamp).toLocaleTimeString("vi-VN")]}),c.testMode&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-600 dark:bg-blue-900/50 dark:text-blue-400 px-2 py-1 rounded",children:"Test Mode"})]})]})]},c.id))}),r.length===0&&e.jsxs("div",{className:`text-center ${t.text.secondary} py-12`,children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg mb-2",children:"Chưa có ảnh nào được tạo"}),e.jsx("p",{className:"text-sm",children:'Nhập mô tả ảnh và bấm "Tạo ảnh" để bắt đầu'})]}),r.length>5&&e.jsx("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:["⚠️ ",e.jsx("strong",{children:"Lưu ý về Storage:"})," Do giới hạn lưu trữ, chỉ giữ tối đa 10 ảnh gần nhất. Hãy download ảnh quan trọng để lưu trữ lâu dài!"]})})]})]})},ie=g.createContext(),Ee=({children:r})=>{const[s,d]=g.useState(null),i=async o=>{try{await window.puter.kv.set("currentChatSession",JSON.stringify(o)),d(o),window.dispatchEvent(new CustomEvent("loadSavedChat",{detail:o}))}catch(h){console.error("Lỗi load chat:",h)}};return e.jsx(ie.Provider,{value:{currentChat:s,setCurrentChat:d,loadChatFromSaved:i},children:r})},Ge=()=>{var M,I,S;const{isDark:r}=B(),[s,d]=g.useState([]),[i,o]=g.useState(null),{loadChatFromSaved:h}=g.useContext(ie)||{};g.useEffect(()=>{l()},[]);const l=async()=>{try{const m=await window.puter.kv.get("savedChats");m&&d(JSON.parse(m))}catch(m){console.error("Lỗi tải chat:",m)}},w=async m=>{try{const c=s.filter(k=>k.id!==m);d(c),await window.puter.kv.set("savedChats",JSON.stringify(c))}catch(c){console.error("Lỗi xóa chat:",c)}},u=async m=>{try{h?(await h(m),alert(`Đã tải chat: "${m.title}". Chuyển sang tab Chat AI để xem!`)):(await window.puter.kv.set("currentChatSession",JSON.stringify(m)),window.location.reload())}catch(c){console.error("Lỗi tải chat:",c),alert("Có lỗi khi tải chat. Vui lòng thử lại!")}},x=m=>{o(m)},$=m=>({"gpt-4o":"GPT-4o","gpt-4o-mini":"GPT-4o Mini","gpt-4.1":"GPT-4.1","gpt-4.1-mini":"GPT-4.1 Mini","gpt-4.1-nano":"GPT-4.1 Nano","claude-sonnet-4":"Claude Sonnet 4","claude-opus-4":"Claude Opus 4","claude-3-5-sonnet":"Claude 3.5 Sonnet",claude:"Claude 3.7 Sonnet","google/gemini-2.5-flash":"Gemini 2.5 Flash","google/gemini-pro":"Gemini Pro","meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo":"Llama 3.1 70B",o1:"o1","o1-mini":"o1 Mini","o3-mini":"o3 Mini"})[m]||m;return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:`${t.card} rounded-2xl shadow-lg overflow-hidden`,children:[e.jsxs("div",{className:`border-b ${t.border.primary} ${t.bg.secondary} px-6 py-4 flex justify-between items-center`,children:[e.jsxs("h2",{className:`text-lg font-semibold ${t.text.primary}`,children:["Chat đã lưu (",s.length,")"]}),e.jsx("button",{onClick:l,className:`${t.text.accent} ${t.interactive.hover} text-sm`,children:"Làm mới"})]}),e.jsx("div",{className:`p-6 ${t.bg.primary}`,children:s.length===0?e.jsxs("div",{className:`text-center ${t.text.secondary} py-8`,children:[e.jsx(te,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Chưa có chat nào được lưu"})]}):e.jsx("div",{className:"space-y-3",children:s.slice().reverse().map(m=>{var c;return e.jsx("div",{className:`p-4 border ${t.border.primary} rounded-lg hover:shadow-md transition duration-200 cursor-pointer ${(i==null?void 0:i.id)===m.id?`border-blue-500 ${r?"bg-blue-900/20":"bg-blue-50"}`:`${t.interactive.hover}`}`,onClick:()=>x(m),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-medium ${t.text.primary} mb-2 line-clamp-2`,children:m.title}),e.jsxs("div",{className:`flex items-center space-x-4 text-sm ${t.text.secondary} mb-3`,children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs("span",{children:[((c=m.messages)==null?void 0:c.length)||0," tin nhắn"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:$(m.model||"gpt-4o-mini")})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx("span",{children:new Date(m.timestamp).toLocaleDateString("vi-VN")})]})]}),e.jsx("div",{className:`text-xs ${t.text.tertiary} ${t.bg.tertiary} p-2 rounded`,children:m.messages&&m.messages.length>0?`${m.messages[0].content.substring(0,80)}${m.messages[0].content.length>80?"...":""}`:"Không có tin nhắn"})]}),e.jsxs("div",{className:"flex flex-col space-y-2 ml-4",children:[e.jsx("button",{onClick:k=>{k.stopPropagation(),u(m)},className:"bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition duration-200",children:"Tải"}),e.jsx("button",{onClick:k=>{k.stopPropagation(),w(m.id)},className:"bg-red-500 text-white p-1 rounded hover:bg-red-600 transition duration-200",children:e.jsx(F,{className:"h-4 w-4"})})]})]})},m.id)})})})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:`${t.card} rounded-2xl shadow-lg overflow-hidden h-fit sticky top-6`,children:[e.jsx("div",{className:`border-b ${t.border.primary} ${t.bg.secondary} px-6 py-4`,children:e.jsx("h3",{className:`text-lg font-semibold ${t.text.primary}`,children:"Preview Chat"})}),e.jsx("div",{className:`p-6 ${t.bg.primary}`,children:i?e.jsxs("div",{children:[e.jsx("h4",{className:`font-medium ${t.text.primary} mb-3`,children:i.title}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t.text.secondary,children:"Tin nhắn:"}),e.jsx("span",{className:`font-medium ${t.text.primary}`,children:((M=i.messages)==null?void 0:M.length)||0})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t.text.secondary,children:"Model:"}),e.jsx("span",{className:`font-medium ${t.text.primary}`,children:$(i.model||"gpt-4o-mini")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:t.text.secondary,children:"Ngày tạo:"}),e.jsx("span",{className:`font-medium ${t.text.primary}`,children:new Date(i.timestamp).toLocaleDateString("vi-VN")})]})]}),e.jsxs("div",{className:`border-t ${t.border.primary} pt-4`,children:[e.jsx("h5",{className:`font-medium ${t.text.primary} mb-3`,children:"Nội dung chat:"}),e.jsxs("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:[(I=i.messages)==null?void 0:I.slice(0,6).map((m,c)=>e.jsxs("div",{className:`text-sm p-2 rounded ${m.role==="user"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300":`${t.bg.secondary} ${t.text.primary}`}`,children:[e.jsxs("div",{className:"font-medium text-xs mb-1",children:[m.role==="user"?"👤 Bạn":"🤖 AI",m.model&&` (${$(m.model)})`]}),e.jsx("div",{className:"line-clamp-3",children:m.content})]},c)),((S=i.messages)==null?void 0:S.length)>6&&e.jsxs("div",{className:`text-center ${t.text.tertiary} text-xs`,children:["... và ",i.messages.length-6," tin nhắn khác"]})]})]}),e.jsx("button",{onClick:()=>u(i),className:"w-full mt-4 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-200",children:"Tải chat này"})]}):e.jsxs("div",{className:`text-center ${t.text.secondary} py-8`,children:[e.jsx(R,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Chọn một chat để xem preview"})]})})]})})]})},Z=({onSignIn:r,onSignOut:s,isSignedIn:d=!1})=>d?e.jsxs("button",{onClick:s,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition duration-200",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{children:"Đăng xuất"})]}):e.jsxs("button",{onClick:r,className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-blue-600 hover:to-purple-700 transition duration-300 transform hover:scale-105 shadow-lg",children:[e.jsx(ke,{className:"inline-block h-5 w-5 mr-2"}),"Đăng nhập với Puter"]}),Ue=()=>{const[r,s]=g.useState(null),[d,i]=g.useState(!0);return g.useEffect(()=>{const l=async()=>{if(window.puter)try{const w=await window.puter.auth.getUser();w&&s(w)}catch{console.log("User chưa đăng nhập")}i(!1)};if(window.puter)l();else{const w=setInterval(()=>{window.puter&&(clearInterval(w),l())},100)}},[]),{user:r,signIn:async()=>{try{const l=await window.puter.auth.signIn();return s(l),l}catch(l){throw console.error("Lỗi đăng nhập:",l),l}},signOut:async()=>{try{await window.puter.auth.signOut(),s(null)}catch(l){throw console.error("Lỗi đăng xuất:",l),l}},isLoading:d}},Re=r=>{g.useEffect(()=>{r.title&&(document.title=r.title);const s=(i,o,h=!1,l=!1)=>{let w="";l?w=`meta[http-equiv="${i}"]`:h?w=`meta[property="${i}"]`:w=`meta[name="${i}"]`;let u=document.querySelector(w);u?u.setAttribute("content",o):(u=document.createElement("meta"),l?u.setAttribute("http-equiv",i):h?u.setAttribute("property",i):u.setAttribute("name",i),u.setAttribute("content",o),document.head.appendChild(u))};r.description&&s("description",r.description),r.keywords&&s("keywords",r.keywords),r.title&&s("og:title",r.title,!0),r.description&&s("og:description",r.description,!0),r.image&&s("og:image",r.image,!0),r.url&&s("og:url",r.url,!0),r.title&&s("twitter:title",r.title,!0),r.description&&s("twitter:description",r.description,!0),r.image&&s("twitter:image",r.image,!0),r.themeColor&&s("theme-color",r.themeColor);let d=document.querySelector('link[rel="canonical"]');if(d?d.setAttribute("href",window.location.href):(d=document.createElement("link"),d.setAttribute("rel","canonical"),d.setAttribute("href",window.location.href),document.head.appendChild(d)),r.structuredData){let i=document.querySelector('script[type="application/ld+json"]');i?i.textContent=JSON.stringify(r.structuredData):(i=document.createElement("script"),i.setAttribute("type","application/ld+json"),i.textContent=JSON.stringify(r.structuredData),document.head.appendChild(i))}},[r])},De=()=>{var M;const{user:r,signIn:s,signOut:d,isLoading:i}=Ue(),{isDark:o}=B(),[h,l]=g.useState("chat"),w=[{id:"chat",label:"Chat AI",icon:R,component:Oe},{id:"images",label:"Tạo Ảnh",icon:V,component:Me},{id:"saved",label:"Đã Lưu",icon:te,component:Ge}],x=(()=>{const I=window.location.origin,S=window.location.href;if(i)return{title:"Đang tải... - Puter AI Assistant",description:"Đang khởi tạo Puter AI Assistant...",keywords:"puter ai, loading, ai assistant",url:S,image:`${I}/og-image.png`,themeColor:o?"#1f2937":"#6366f1"};if(!r)return{title:"Đăng nhập - Puter AI Assistant",description:"Đăng nhập vào Puter AI Assistant để truy cập 25+ AI models miễn phí với lưu trữ cloud.",keywords:"puter ai, đăng nhập, ai assistant, chat ai, miễn phí",url:S,image:`${I}/og-image.png`,themeColor:o?"#1f2937":"#6366f1"};switch(h){case"chat":return{title:"Chat AI - Puter AI Assistant",description:"Trò chuyện với 25+ AI models như GPT-4, Claude, Gemini. Tự động lưu lịch sử, hỗ trợ upload file và phân tích ảnh.",keywords:"chat ai, gpt-4, claude, gemini, ai assistant, chatbot, artificial intelligence",url:S,image:`${I}/og-image-chat.png`,themeColor:o?"#1f2937":"#6366f1",structuredData:{"@context":"https://schema.org","@type":"SoftwareApplication",name:"Puter AI Chat",description:"Chat với 25+ AI models miễn phí",url:S,applicationCategory:"AI Chat Assistant",operatingSystem:"Web Browser",offers:{"@type":"Offer",price:"0",priceCurrency:"USD"},featureList:["GPT-4","Claude","Gemini","25+ AI Models"]}};case"images":return{title:"Tạo Ảnh AI - Puter AI Assistant",description:"Tạo ảnh nghệ thuật với AI sử dụng DALL-E. Miễn phí với Test Mode, chất lượng cao với Production Mode.",keywords:"tạo ảnh ai, dall-e, ai art, image generation, text to image, ai artwork",url:S,image:`${I}/og-image-art.png`,themeColor:o?"#1f2937":"#8b5cf6",structuredData:{"@context":"https://schema.org","@type":"SoftwareApplication",name:"Puter AI Image Generator",description:"Tạo ảnh nghệ thuật với AI",url:S,applicationCategory:"AI Image Generator",operatingSystem:"Web Browser",offers:{"@type":"Offer",price:"0",priceCurrency:"USD"},featureList:["DALL-E","Text to Image","AI Art Generation"]}};case"saved":return{title:"Dữ Liệu Đã Lưu - Puter AI Assistant",description:"Quản lý và xem lại tất cả cuộc trò chuyện AI đã lưu. Tự động đồng bộ với Puter Cloud.",keywords:"lưu trữ chat, quản lý dữ liệu, puter cloud, backup chat ai",url:S,image:`${I}/og-image.png`,themeColor:o?"#1f2937":"#6366f1"};default:return{title:"Puter AI Assistant - 25+ AI Models Miễn Phí",description:"Trợ lý AI toàn diện với 25+ models, tạo ảnh, chat thông minh và lưu trữ cloud miễn phí.",keywords:"puter ai, ai assistant, gpt-4, claude, gemini, ai models, miễn phí",url:S,image:`${I}/og-image.png`,themeColor:o?"#1f2937":"#6366f1",structuredData:{"@context":"https://schema.org","@type":"SoftwareApplication",name:"Puter AI Assistant",description:"Trợ lý AI toàn diện với 25+ models, tạo ảnh và lưu trữ cloud miễn phí",url:I,applicationCategory:"AI Assistant",operatingSystem:"Web Browser",offers:{"@type":"Offer",price:"0",priceCurrency:"USD"},author:{"@type":"Organization",name:"Min Producer",url:"https://minproducer.com"},featureList:["25+ AI Models","Chat với GPT-4, Claude, Gemini","Tạo ảnh với DALL-E","Tự động lưu lịch sử","Dark/Light theme","Upload và phân tích file","Đồng bộ cloud miễn phí"]}}}})();if(Re(x),i)return e.jsx("div",{className:`min-h-screen flex items-center justify-center ${t.gradient.primary}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-500 mx-auto mb-4"}),e.jsx("p",{className:`${t.text.secondary}`,children:"Đang khởi tạo Puter AI..."})]})});if(!r)return e.jsx("div",{className:`min-h-screen ${t.gradient.primary} flex items-center justify-center p-4`,children:e.jsxs("div",{className:`${t.card} rounded-2xl shadow-2xl p-8 max-w-md w-full`,children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(Y,{})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:`w-20 h-20 ${t.gradient.header} rounded-full flex items-center justify-center mx-auto mb-4`,children:e.jsx(R,{className:"h-10 w-10 text-white"})}),e.jsx("h1",{className:`text-3xl font-bold ${t.text.primary} mb-2`,children:"Puter AI Assistant"}),e.jsx("p",{className:`${t.text.secondary} mb-4`,children:"Trí tuệ nhân tạo với lưu trữ cloud miễn phí"}),e.jsxs("div",{className:`text-left ${t.bg.secondary} p-4 rounded-lg mb-6`,children:[e.jsx("h3",{className:`font-semibold ${t.text.primary} mb-2`,children:"Tính năng:"}),e.jsxs("ul",{className:`text-sm ${t.text.secondary} space-y-1`,children:[e.jsx("li",{children:"✨ 25+ AI models (GPT-4, Claude, Gemini, Llama...)"}),e.jsx("li",{children:"💾 Tự động lưu lịch sử chat"}),e.jsx("li",{children:"🎨 Tạo ảnh với DALL-E 3"}),e.jsx("li",{children:"📁 Upload & phân tích files (PDF, DOC, IMG...)"}),e.jsx("li",{children:"🌙 Dark/Light theme"}),e.jsx("li",{children:"☁️ Đồng bộ dữ liệu qua cloud"}),e.jsx("li",{children:"🆓 Hoàn toàn miễn phí"})]})]})]}),e.jsx(Z,{onSignIn:s})]})});const $=(M=w.find(I=>I.id===h))==null?void 0:M.component;return e.jsxs("div",{className:`min-h-screen ${t.bg.secondary}`,children:[e.jsx("header",{className:`${t.bg.primary} shadow-lg border-b ${t.border.primary}`,children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-8 h-8 ${t.gradient.header} rounded-full flex items-center justify-center`,children:e.jsx(R,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-xl font-bold ${t.text.primary}`,children:"Puter AI Assistant"}),e.jsx("p",{className:`text-xs ${t.text.tertiary}`,children:"25+ AI Models • Auto-save • Dark Mode • Free Forever"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Y,{}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:`text-sm ${t.text.secondary}`,children:["Xin chào, ",r.username||"User"]}),e.jsx("p",{className:`text-xs ${t.text.tertiary}`,children:"Puter Cloud Account"})]}),e.jsx(Z,{onSignOut:d,isSignedIn:!0})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx("div",{className:`flex space-x-1 ${t.bg.tertiary} rounded-xl p-1 mb-6`,children:w.map(I=>{const S=I.icon;return e.jsxs("button",{onClick:()=>l(I.id),className:`flex items-center space-x-2 px-4 py-3 rounded-lg font-medium transition duration-200 ${h===I.id?`${t.bg.primary} ${t.text.accent} shadow-md transform scale-105`:`${t.text.secondary} ${t.interactive.hover}`}`,children:[e.jsx(S,{className:"h-5 w-5"}),e.jsx("span",{children:I.label}),I.id==="chat"&&e.jsx("span",{className:`${t.bg.accent} ${t.text.accent} text-xs px-2 py-1 rounded-full`,children:"25+ Models"})]},I.id)})}),e.jsx("div",{className:"animate-fade-in",children:$&&e.jsx($,{})}),e.jsxs("footer",{className:`mt-12 text-center ${t.text.tertiary} text-sm`,children:[e.jsxs("p",{children:["Powered by ",e.jsx("a",{href:"https://puter.com",target:"_blank",rel:"noopener noreferrer",className:`${t.text.accent} hover:underline`,children:"Puter.js"})," • User Pays Model • Privacy First"]}),e.jsx("p",{className:"mt-1",children:"No API keys required • Infinitely scalable • Open source"})]})]})]})};function Fe(){return g.useEffect(()=>{(()=>{document.documentElement.lang="vi",[{name:"robots",content:"index, follow"},{name:"language",content:"vi"},{name:"author",content:"Min Producer"},{name:"viewport",content:"width=device-width, initial-scale=1.0"},{name:"application-name",content:"Puter AI Assistant"},{name:"mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-capable",content:"yes"},{name:"apple-mobile-web-app-status-bar-style",content:"default"},{name:"apple-mobile-web-app-title",content:"Puter AI"},{property:"og:type",content:"website"},{property:"og:site_name",content:"Puter AI Assistant"},{property:"twitter:card",content:"summary_large_image"},{httpEquiv:"X-Content-Type-Options",content:"nosniff"},{httpEquiv:"X-Frame-Options",content:"DENY"},{httpEquiv:"X-XSS-Protection",content:"1; mode=block"}].forEach(i=>{const{name:o,property:h,httpEquiv:l,content:w}=i;let u="";if(o&&(u=`meta[name="${o}"]`),h&&(u=`meta[property="${h}"]`),l&&(u=`meta[http-equiv="${l}"]`),!document.querySelector(u)){const x=document.createElement("meta");o&&x.setAttribute("name",o),h&&x.setAttribute("property",h),l&&x.setAttribute("http-equiv",l),x.setAttribute("content",w),document.head.appendChild(x)}}),[{rel:"icon",type:"image/x-icon",href:"/favicon.ico"},{rel:"apple-touch-icon",sizes:"180x180",href:"/apple-touch-icon.png"},{rel:"icon",type:"image/png",sizes:"96x96",href:"/favicon-96x96.png"},{rel:"icon",type:"image/svg+xml",href:"/favicon.svg"},{rel:"manifest",href:"/manifest.json"},{rel:"manifest",href:"/site.webmanifest"}].forEach(i=>{const{rel:o,type:h,sizes:l,href:w}=i;let u=`link[rel="${o}"]`;if(l&&(u+=`[sizes="${l}"]`),!document.querySelector(u)){const x=document.createElement("link");x.rel=o,h&&(x.type=h),l&&(x.sizes=l),x.href=w,document.head.appendChild(x)}})})()},[]),e.jsx(Pe,{children:e.jsx(Ee,{children:e.jsx(De,{})})})}ne(document.getElementById("root")).render(e.jsx(g.StrictMode,{children:e.jsx(Fe,{})}));
